{"ast":null,"code":"import { BufferGeometry, Mesh, SphereGeometry, Color, MeshLambertMaterial, BufferAttribute, Line, Group, CylinderGeometry, Matrix4, Box3, CubicBezierCurve3, QuadraticBezierCurve3, LineBasicMaterial, ConeGeometry, TubeGeometry, Vector3 } from 'three';\nimport { forceRadial, forceSimulation, forceLink, forceManyBody, forceCenter } from 'd3-force-3d';\nimport graph from 'ngraph.graph';\nimport forcelayout from 'ngraph.forcelayout';\nimport Kapsule from 'kapsule';\nimport accessorFn from 'accessor-fn';\nimport { min, max } from 'd3-array';\nimport DataBindMapper from 'data-bind-mapper';\nimport { scaleOrdinal } from 'd3-scale';\nimport { schemePaired } from 'd3-scale-chromatic';\nimport tinyColor from 'tinycolor2';\nfunction _arrayLikeToArray(r, a) {\n  (null == a || a > r.length) && (a = r.length);\n  for (var e = 0, n = Array(a); e < a; e++) n[e] = r[e];\n  return n;\n}\nfunction _arrayWithHoles(r) {\n  if (Array.isArray(r)) return r;\n}\nfunction _arrayWithoutHoles(r) {\n  if (Array.isArray(r)) return _arrayLikeToArray(r);\n}\nfunction _assertClassBrand(e, t, n) {\n  if (\"function\" == typeof e ? e === t : e.has(t)) return arguments.length < 3 ? t : n;\n  throw new TypeError(\"Private element is not present on this object\");\n}\nfunction _assertThisInitialized(e) {\n  if (void 0 === e) throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");\n  return e;\n}\nfunction _callSuper(t, o, e) {\n  return o = _getPrototypeOf(o), _possibleConstructorReturn(t, _isNativeReflectConstruct() ? Reflect.construct(o, e || [], _getPrototypeOf(t).constructor) : o.apply(t, e));\n}\nfunction _checkPrivateRedeclaration(e, t) {\n  if (t.has(e)) throw new TypeError(\"Cannot initialize the same private elements twice on an object\");\n}\nfunction _classCallCheck(a, n) {\n  if (!(a instanceof n)) throw new TypeError(\"Cannot call a class as a function\");\n}\nfunction _classPrivateFieldGet2(s, a) {\n  return s.get(_assertClassBrand(s, a));\n}\nfunction _classPrivateFieldInitSpec(e, t, a) {\n  _checkPrivateRedeclaration(e, t), t.set(e, a);\n}\nfunction _classPrivateFieldSet2(s, a, r) {\n  return s.set(_assertClassBrand(s, a), r), r;\n}\nfunction _construct(t, e, r) {\n  if (_isNativeReflectConstruct()) return Reflect.construct.apply(null, arguments);\n  var o = [null];\n  o.push.apply(o, e);\n  var p = new (t.bind.apply(t, o))();\n  return p;\n}\nfunction _defineProperties(e, r) {\n  for (var t = 0; t < r.length; t++) {\n    var o = r[t];\n    o.enumerable = o.enumerable || false, o.configurable = true, \"value\" in o && (o.writable = true), Object.defineProperty(e, _toPropertyKey(o.key), o);\n  }\n}\nfunction _createClass(e, r, t) {\n  return r && _defineProperties(e.prototype, r), Object.defineProperty(e, \"prototype\", {\n    writable: false\n  }), e;\n}\nfunction _defineProperty(e, r, t) {\n  return (r = _toPropertyKey(r)) in e ? Object.defineProperty(e, r, {\n    value: t,\n    enumerable: true,\n    configurable: true,\n    writable: true\n  }) : e[r] = t, e;\n}\nfunction _get() {\n  return _get = \"undefined\" != typeof Reflect && Reflect.get ? Reflect.get.bind() : function (e, t, r) {\n    var p = _superPropBase(e, t);\n    if (p) {\n      var n = Object.getOwnPropertyDescriptor(p, t);\n      return n.get ? n.get.call(arguments.length < 3 ? e : r) : n.value;\n    }\n  }, _get.apply(null, arguments);\n}\nfunction _getPrototypeOf(t) {\n  return _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf.bind() : function (t) {\n    return t.__proto__ || Object.getPrototypeOf(t);\n  }, _getPrototypeOf(t);\n}\nfunction _inherits(t, e) {\n  if (\"function\" != typeof e && null !== e) throw new TypeError(\"Super expression must either be null or a function\");\n  t.prototype = Object.create(e && e.prototype, {\n    constructor: {\n      value: t,\n      writable: true,\n      configurable: true\n    }\n  }), Object.defineProperty(t, \"prototype\", {\n    writable: false\n  }), e && _setPrototypeOf(t, e);\n}\nfunction _isNativeReflectConstruct() {\n  try {\n    var t = !Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {}));\n  } catch (t) {}\n  return (_isNativeReflectConstruct = function () {\n    return !!t;\n  })();\n}\nfunction _iterableToArray(r) {\n  if (\"undefined\" != typeof Symbol && null != r[Symbol.iterator] || null != r[\"@@iterator\"]) return Array.from(r);\n}\nfunction _iterableToArrayLimit(r, l) {\n  var t = null == r ? null : \"undefined\" != typeof Symbol && r[Symbol.iterator] || r[\"@@iterator\"];\n  if (null != t) {\n    var e,\n      n,\n      i,\n      u,\n      a = [],\n      f = true,\n      o = false;\n    try {\n      if (i = (t = t.call(r)).next, 0 === l) ;else for (; !(f = (e = i.call(t)).done) && (a.push(e.value), a.length !== l); f = !0);\n    } catch (r) {\n      o = true, n = r;\n    } finally {\n      try {\n        if (!f && null != t.return && (u = t.return(), Object(u) !== u)) return;\n      } finally {\n        if (o) throw n;\n      }\n    }\n    return a;\n  }\n}\nfunction _nonIterableRest() {\n  throw new TypeError(\"Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n}\nfunction _nonIterableSpread() {\n  throw new TypeError(\"Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n}\nfunction ownKeys(e, r) {\n  var t = Object.keys(e);\n  if (Object.getOwnPropertySymbols) {\n    var o = Object.getOwnPropertySymbols(e);\n    r && (o = o.filter(function (r) {\n      return Object.getOwnPropertyDescriptor(e, r).enumerable;\n    })), t.push.apply(t, o);\n  }\n  return t;\n}\nfunction _objectSpread2(e) {\n  for (var r = 1; r < arguments.length; r++) {\n    var t = null != arguments[r] ? arguments[r] : {};\n    r % 2 ? ownKeys(Object(t), true).forEach(function (r) {\n      _defineProperty(e, r, t[r]);\n    }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(e, Object.getOwnPropertyDescriptors(t)) : ownKeys(Object(t)).forEach(function (r) {\n      Object.defineProperty(e, r, Object.getOwnPropertyDescriptor(t, r));\n    });\n  }\n  return e;\n}\nfunction _possibleConstructorReturn(t, e) {\n  if (e && (\"object\" == typeof e || \"function\" == typeof e)) return e;\n  if (void 0 !== e) throw new TypeError(\"Derived constructors may only return object or undefined\");\n  return _assertThisInitialized(t);\n}\nfunction _setPrototypeOf(t, e) {\n  return _setPrototypeOf = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function (t, e) {\n    return t.__proto__ = e, t;\n  }, _setPrototypeOf(t, e);\n}\nfunction _slicedToArray(r, e) {\n  return _arrayWithHoles(r) || _iterableToArrayLimit(r, e) || _unsupportedIterableToArray(r, e) || _nonIterableRest();\n}\nfunction _superPropBase(t, o) {\n  for (; !{}.hasOwnProperty.call(t, o) && null !== (t = _getPrototypeOf(t)););\n  return t;\n}\nfunction _superPropGet(t, o, e, r) {\n  var p = _get(_getPrototypeOf(t.prototype), o, e);\n  return \"function\" == typeof p ? function (t) {\n    return p.apply(e, t);\n  } : p;\n}\nfunction _toConsumableArray(r) {\n  return _arrayWithoutHoles(r) || _iterableToArray(r) || _unsupportedIterableToArray(r) || _nonIterableSpread();\n}\nfunction _toPrimitive(t, r) {\n  if (\"object\" != typeof t || !t) return t;\n  var e = t[Symbol.toPrimitive];\n  if (void 0 !== e) {\n    var i = e.call(t, r);\n    if (\"object\" != typeof i) return i;\n    throw new TypeError(\"@@toPrimitive must return a primitive value.\");\n  }\n  return (\"string\" === r ? String : Number)(t);\n}\nfunction _toPropertyKey(t) {\n  var i = _toPrimitive(t, \"string\");\n  return \"symbol\" == typeof i ? i : i + \"\";\n}\nfunction _typeof(o) {\n  \"@babel/helpers - typeof\";\n\n  return _typeof = \"function\" == typeof Symbol && \"symbol\" == typeof Symbol.iterator ? function (o) {\n    return typeof o;\n  } : function (o) {\n    return o && \"function\" == typeof Symbol && o.constructor === Symbol && o !== Symbol.prototype ? \"symbol\" : typeof o;\n  }, _typeof(o);\n}\nfunction _unsupportedIterableToArray(r, a) {\n  if (r) {\n    if (\"string\" == typeof r) return _arrayLikeToArray(r, a);\n    var t = {}.toString.call(r).slice(8, -1);\n    return \"Object\" === t && r.constructor && (t = r.constructor.name), \"Map\" === t || \"Set\" === t ? Array.from(r) : \"Arguments\" === t || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t) ? _arrayLikeToArray(r, a) : void 0;\n  }\n}\nvar _materialDispose = function materialDispose(material) {\n  if (material instanceof Array) {\n    material.forEach(_materialDispose);\n  } else {\n    if (material.map) {\n      material.map.dispose();\n    }\n    material.dispose();\n  }\n};\nvar _deallocate = function deallocate(obj) {\n  if (obj.geometry) {\n    obj.geometry.dispose();\n  }\n  if (obj.material) {\n    _materialDispose(obj.material);\n  }\n  if (obj.texture) {\n    obj.texture.dispose();\n  }\n  if (obj.children) {\n    obj.children.forEach(_deallocate);\n  }\n};\nvar emptyObject = function emptyObject(obj) {\n  while (obj.children.length) {\n    var childObj = obj.children[0];\n    obj.remove(childObj);\n    _deallocate(childObj);\n  }\n};\nvar _dataBindAttr = /*#__PURE__*/new WeakMap();\nvar _objBindAttr = /*#__PURE__*/new WeakMap();\nvar ThreeDigest = /*#__PURE__*/function (_DataBindMapper) {\n  function ThreeDigest(scene) {\n    var _this;\n    var _ref = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {},\n      _ref$dataBindAttr = _ref.dataBindAttr,\n      dataBindAttr = _ref$dataBindAttr === void 0 ? '__data' : _ref$dataBindAttr,\n      _ref$objBindAttr = _ref.objBindAttr,\n      objBindAttr = _ref$objBindAttr === void 0 ? '__threeObj' : _ref$objBindAttr;\n    _classCallCheck(this, ThreeDigest);\n    _this = _callSuper(this, ThreeDigest);\n    _defineProperty(_this, \"scene\", void 0);\n    _classPrivateFieldInitSpec(_this, _dataBindAttr, void 0);\n    _classPrivateFieldInitSpec(_this, _objBindAttr, void 0);\n    _this.scene = scene;\n    _classPrivateFieldSet2(_dataBindAttr, _this, dataBindAttr);\n    _classPrivateFieldSet2(_objBindAttr, _this, objBindAttr);\n    _this.onRemoveObj(function () {});\n    return _this;\n  }\n  _inherits(ThreeDigest, _DataBindMapper);\n  return _createClass(ThreeDigest, [{\n    key: \"onCreateObj\",\n    value: function onCreateObj(fn) {\n      var _this2 = this;\n      _superPropGet(ThreeDigest, \"onCreateObj\", this)([function (d) {\n        var obj = fn(d);\n        d[_classPrivateFieldGet2(_objBindAttr, _this2)] = obj;\n        obj[_classPrivateFieldGet2(_dataBindAttr, _this2)] = d;\n        _this2.scene.add(obj);\n        return obj;\n      }]);\n      return this;\n    }\n  }, {\n    key: \"onRemoveObj\",\n    value: function onRemoveObj(fn) {\n      var _this3 = this;\n      _superPropGet(ThreeDigest, \"onRemoveObj\", this)([function (obj, dId) {\n        var d = _superPropGet(ThreeDigest, \"getData\", _this3)([obj]);\n        fn(obj, dId);\n        _this3.scene.remove(obj);\n        emptyObject(obj);\n        delete d[_classPrivateFieldGet2(_objBindAttr, _this3)];\n      }]);\n      return this;\n    }\n  }]);\n}(DataBindMapper);\nvar colorStr2Hex = function colorStr2Hex(str) {\n  return isNaN(str) ? parseInt(tinyColor(str).toHex(), 16) : str;\n};\nvar colorAlpha = function colorAlpha(str) {\n  return isNaN(str) ? tinyColor(str).getAlpha() : 1;\n};\nvar autoColorScale = scaleOrdinal(schemePaired);\n\n// Autoset attribute colorField by colorByAccessor property\n// If an object has already a color, don't set it\n// Objects can be nodes or links\nfunction autoColorObjects(objects, colorByAccessor, colorField) {\n  if (!colorByAccessor || typeof colorField !== 'string') return;\n  objects.filter(function (obj) {\n    return !obj[colorField];\n  }).forEach(function (obj) {\n    obj[colorField] = autoColorScale(colorByAccessor(obj));\n  });\n}\nfunction getDagDepths(_ref, idAccessor) {\n  var nodes = _ref.nodes,\n    links = _ref.links;\n  var _ref2 = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {},\n    _ref2$nodeFilter = _ref2.nodeFilter,\n    nodeFilter = _ref2$nodeFilter === void 0 ? function () {\n      return true;\n    } : _ref2$nodeFilter,\n    _ref2$onLoopError = _ref2.onLoopError,\n    onLoopError = _ref2$onLoopError === void 0 ? function (loopIds) {\n      throw \"Invalid DAG structure! Found cycle in node path: \".concat(loopIds.join(' -> '), \".\");\n    } : _ref2$onLoopError;\n  // linked graph\n  var graph = {};\n  nodes.forEach(function (node) {\n    return graph[idAccessor(node)] = {\n      data: node,\n      out: [],\n      depth: -1,\n      skip: !nodeFilter(node)\n    };\n  });\n  links.forEach(function (_ref3) {\n    var source = _ref3.source,\n      target = _ref3.target;\n    var sourceId = getNodeId(source);\n    var targetId = getNodeId(target);\n    if (!graph.hasOwnProperty(sourceId)) throw \"Missing source node with id: \".concat(sourceId);\n    if (!graph.hasOwnProperty(targetId)) throw \"Missing target node with id: \".concat(targetId);\n    var sourceNode = graph[sourceId];\n    var targetNode = graph[targetId];\n    sourceNode.out.push(targetNode);\n    function getNodeId(node) {\n      return _typeof(node) === 'object' ? idAccessor(node) : node;\n    }\n  });\n  var foundLoops = [];\n  traverse(Object.values(graph));\n  var nodeDepths = Object.assign.apply(Object, [{}].concat(_toConsumableArray(Object.entries(graph).filter(function (_ref4) {\n    var _ref5 = _slicedToArray(_ref4, 2),\n      node = _ref5[1];\n    return !node.skip;\n  }).map(function (_ref6) {\n    var _ref7 = _slicedToArray(_ref6, 2),\n      id = _ref7[0],\n      node = _ref7[1];\n    return _defineProperty({}, id, node.depth);\n  }))));\n  return nodeDepths;\n  function traverse(nodes) {\n    var nodeStack = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : [];\n    var currentDepth = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 0;\n    var _loop = function _loop() {\n      var node = nodes[i];\n      if (nodeStack.indexOf(node) !== -1) {\n        var loop = [].concat(_toConsumableArray(nodeStack.slice(nodeStack.indexOf(node))), [node]).map(function (d) {\n          return idAccessor(d.data);\n        });\n        if (!foundLoops.some(function (foundLoop) {\n          return foundLoop.length === loop.length && foundLoop.every(function (id, idx) {\n            return id === loop[idx];\n          });\n        })) {\n          foundLoops.push(loop);\n          onLoopError(loop);\n        }\n        return 1; // continue\n      }\n      if (currentDepth > node.depth) {\n        // Don't unnecessarily revisit chunks of the graph\n        node.depth = currentDepth;\n        traverse(node.out, [].concat(_toConsumableArray(nodeStack), [node]), currentDepth + (node.skip ? 0 : 1));\n      }\n    };\n    for (var i = 0, l = nodes.length; i < l; i++) {\n      if (_loop()) continue;\n    }\n  }\n}\nvar three$1 = window.THREE ? window.THREE // Prefer consumption from global THREE, if exists\n: {\n  Group: Group,\n  Mesh: Mesh,\n  MeshLambertMaterial: MeshLambertMaterial,\n  Color: Color,\n  BufferGeometry: BufferGeometry,\n  BufferAttribute: BufferAttribute,\n  Matrix4: Matrix4,\n  Vector3: Vector3,\n  SphereGeometry: SphereGeometry,\n  CylinderGeometry: CylinderGeometry,\n  TubeGeometry: TubeGeometry,\n  ConeGeometry: ConeGeometry,\n  Line: Line,\n  LineBasicMaterial: LineBasicMaterial,\n  QuadraticBezierCurve3: QuadraticBezierCurve3,\n  CubicBezierCurve3: CubicBezierCurve3,\n  Box3: Box3\n};\nvar ngraph = {\n  graph: graph,\n  forcelayout: forcelayout\n};\n\n//\n\nvar DAG_LEVEL_NODE_RATIO = 2;\n\n// support multiple method names for backwards threejs compatibility\nvar setAttributeFn = new three$1.BufferGeometry().setAttribute ? 'setAttribute' : 'addAttribute';\nvar applyMatrix4Fn = new three$1.BufferGeometry().applyMatrix4 ? 'applyMatrix4' : 'applyMatrix';\nvar ForceGraph = Kapsule({\n  props: {\n    jsonUrl: {\n      onChange: function onChange(jsonUrl, state) {\n        var _this = this;\n        if (jsonUrl && !state.fetchingJson) {\n          // Load data asynchronously\n          state.fetchingJson = true;\n          state.onLoading();\n          fetch(jsonUrl).then(function (r) {\n            return r.json();\n          }).then(function (json) {\n            state.fetchingJson = false;\n            state.onFinishLoading(json);\n            _this.graphData(json);\n          });\n        }\n      },\n      triggerUpdate: false\n    },\n    graphData: {\n      \"default\": {\n        nodes: [],\n        links: []\n      },\n      onChange: function onChange(graphData, state) {\n        state.engineRunning = false; // Pause simulation immediately\n      }\n    },\n    numDimensions: {\n      \"default\": 3,\n      onChange: function onChange(numDim, state) {\n        var chargeForce = state.d3ForceLayout.force('charge');\n        // Increase repulsion on 3D mode for improved spatial separation\n        if (chargeForce) {\n          chargeForce.strength(numDim > 2 ? -60 : -30);\n        }\n        if (numDim < 3) {\n          eraseDimension(state.graphData.nodes, 'z');\n        }\n        if (numDim < 2) {\n          eraseDimension(state.graphData.nodes, 'y');\n        }\n        function eraseDimension(nodes, dim) {\n          nodes.forEach(function (d) {\n            delete d[dim]; // position\n            delete d[\"v\".concat(dim)]; // velocity\n          });\n        }\n      }\n    },\n    dagMode: {\n      onChange: function onChange(dagMode, state) {\n        // td, bu, lr, rl, zin, zout, radialin, radialout\n        !dagMode && state.forceEngine === 'd3' && (state.graphData.nodes || []).forEach(function (n) {\n          return n.fx = n.fy = n.fz = undefined;\n        }); // unfix nodes when disabling dag mode\n      }\n    },\n    dagLevelDistance: {},\n    dagNodeFilter: {\n      \"default\": function _default(node) {\n        return true;\n      }\n    },\n    onDagError: {\n      triggerUpdate: false\n    },\n    nodeRelSize: {\n      \"default\": 4\n    },\n    // volume per val unit\n    nodeId: {\n      \"default\": 'id'\n    },\n    nodeVal: {\n      \"default\": 'val'\n    },\n    nodeResolution: {\n      \"default\": 8\n    },\n    // how many slice segments in the sphere's circumference\n    nodeColor: {\n      \"default\": 'color'\n    },\n    nodeAutoColorBy: {},\n    nodeOpacity: {\n      \"default\": 0.75\n    },\n    nodeVisibility: {\n      \"default\": true\n    },\n    nodeThreeObject: {},\n    nodeThreeObjectExtend: {\n      \"default\": false\n    },\n    nodePositionUpdate: {\n      triggerUpdate: false\n    },\n    // custom function to call for updating the node's position. Signature: (threeObj, { x, y, z}, node). If the function returns a truthy value, the regular node position update will not run.\n    linkSource: {\n      \"default\": 'source'\n    },\n    linkTarget: {\n      \"default\": 'target'\n    },\n    linkVisibility: {\n      \"default\": true\n    },\n    linkColor: {\n      \"default\": 'color'\n    },\n    linkAutoColorBy: {},\n    linkOpacity: {\n      \"default\": 0.2\n    },\n    linkWidth: {},\n    // Rounded to nearest decimal. For falsy values use dimensionless line with 1px regardless of distance.\n    linkResolution: {\n      \"default\": 6\n    },\n    // how many radial segments in each line tube's geometry\n    linkCurvature: {\n      \"default\": 0,\n      triggerUpdate: false\n    },\n    // line curvature radius (0: straight, 1: semi-circle)\n    linkCurveRotation: {\n      \"default\": 0,\n      triggerUpdate: false\n    },\n    // line curve rotation along the line axis (0: interection with XY plane, PI: upside down)\n    linkMaterial: {},\n    linkThreeObject: {},\n    linkThreeObjectExtend: {\n      \"default\": false\n    },\n    linkPositionUpdate: {\n      triggerUpdate: false\n    },\n    // custom function to call for updating the link's position. Signature: (threeObj, { start: { x, y, z},  end: { x, y, z }}, link). If the function returns a truthy value, the regular link position update will not run.\n    linkDirectionalArrowLength: {\n      \"default\": 0\n    },\n    linkDirectionalArrowColor: {},\n    linkDirectionalArrowRelPos: {\n      \"default\": 0.5,\n      triggerUpdate: false\n    },\n    // value between 0<>1 indicating the relative pos along the (exposed) line\n    linkDirectionalArrowResolution: {\n      \"default\": 8\n    },\n    // how many slice segments in the arrow's conic circumference\n    linkDirectionalParticles: {\n      \"default\": 0\n    },\n    // animate photons travelling in the link direction\n    linkDirectionalParticleSpeed: {\n      \"default\": 0.01,\n      triggerUpdate: false\n    },\n    // in link length ratio per frame\n    linkDirectionalParticleOffset: {\n      \"default\": 0,\n      triggerUpdate: false\n    },\n    // starting position offset along the link's length, like a pre-delay. Values between [0, 1]\n    linkDirectionalParticleWidth: {\n      \"default\": 0.5\n    },\n    linkDirectionalParticleColor: {},\n    linkDirectionalParticleResolution: {\n      \"default\": 4\n    },\n    // how many slice segments in the particle sphere's circumference\n    linkDirectionalParticleThreeObject: {},\n    forceEngine: {\n      \"default\": 'd3'\n    },\n    // d3 or ngraph\n    d3AlphaMin: {\n      \"default\": 0\n    },\n    d3AlphaDecay: {\n      \"default\": 0.0228,\n      triggerUpdate: false,\n      onChange: function onChange(alphaDecay, state) {\n        state.d3ForceLayout.alphaDecay(alphaDecay);\n      }\n    },\n    d3AlphaTarget: {\n      \"default\": 0,\n      triggerUpdate: false,\n      onChange: function onChange(alphaTarget, state) {\n        state.d3ForceLayout.alphaTarget(alphaTarget);\n      }\n    },\n    d3VelocityDecay: {\n      \"default\": 0.4,\n      triggerUpdate: false,\n      onChange: function onChange(velocityDecay, state) {\n        state.d3ForceLayout.velocityDecay(velocityDecay);\n      }\n    },\n    ngraphPhysics: {\n      \"default\": {\n        // defaults from https://github.com/anvaka/ngraph.physics.simulator/blob/master/index.js\n        timeStep: 20,\n        gravity: -1.2,\n        theta: 0.8,\n        springLength: 30,\n        springCoefficient: 0.0008,\n        dragCoefficient: 0.02\n      }\n    },\n    warmupTicks: {\n      \"default\": 0,\n      triggerUpdate: false\n    },\n    // how many times to tick the force engine at init before starting to render\n    cooldownTicks: {\n      \"default\": Infinity,\n      triggerUpdate: false\n    },\n    cooldownTime: {\n      \"default\": 15000,\n      triggerUpdate: false\n    },\n    // ms\n    onLoading: {\n      \"default\": function _default() {},\n      triggerUpdate: false\n    },\n    onFinishLoading: {\n      \"default\": function _default() {},\n      triggerUpdate: false\n    },\n    onUpdate: {\n      \"default\": function _default() {},\n      triggerUpdate: false\n    },\n    onFinishUpdate: {\n      \"default\": function _default() {},\n      triggerUpdate: false\n    },\n    onEngineTick: {\n      \"default\": function _default() {},\n      triggerUpdate: false\n    },\n    onEngineStop: {\n      \"default\": function _default() {},\n      triggerUpdate: false\n    }\n  },\n  methods: {\n    refresh: function refresh(state) {\n      state._flushObjects = true;\n      state._rerender();\n      return this;\n    },\n    // Expose d3 forces for external manipulation\n    d3Force: function d3Force(state, forceName, forceFn) {\n      if (forceFn === undefined) {\n        return state.d3ForceLayout.force(forceName); // Force getter\n      }\n      state.d3ForceLayout.force(forceName, forceFn); // Force setter\n      return this;\n    },\n    d3ReheatSimulation: function d3ReheatSimulation(state) {\n      state.d3ForceLayout.alpha(1);\n      this.resetCountdown();\n      return this;\n    },\n    // reset cooldown state\n    resetCountdown: function resetCountdown(state) {\n      state.cntTicks = 0;\n      state.startTickTime = new Date();\n      state.engineRunning = true;\n      return this;\n    },\n    tickFrame: function tickFrame(state) {\n      var isD3Sim = state.forceEngine !== 'ngraph';\n      if (state.engineRunning) {\n        layoutTick();\n      }\n      updateArrows();\n      updatePhotons();\n      return this;\n\n      //\n\n      function layoutTick() {\n        if (++state.cntTicks > state.cooldownTicks || new Date() - state.startTickTime > state.cooldownTime || isD3Sim && state.d3AlphaMin > 0 && state.d3ForceLayout.alpha() < state.d3AlphaMin) {\n          state.engineRunning = false; // Stop ticking graph\n          state.onEngineStop();\n        } else {\n          state.layout[isD3Sim ? 'tick' : 'step'](); // Tick it\n          state.onEngineTick();\n        }\n        var nodeThreeObjectExtendAccessor = accessorFn(state.nodeThreeObjectExtend);\n\n        // Update nodes position\n        state.nodeDataMapper.entries().forEach(function (_ref) {\n          var _ref2 = _slicedToArray(_ref, 2),\n            node = _ref2[0],\n            obj = _ref2[1];\n          if (!obj) return;\n          var pos = isD3Sim ? node : state.layout.getNodePosition(node[state.nodeId]);\n          var extendedObj = nodeThreeObjectExtendAccessor(node);\n          if (!state.nodePositionUpdate || !state.nodePositionUpdate(extendedObj ? obj.children[0] : obj, {\n            x: pos.x,\n            y: pos.y,\n            z: pos.z\n          }, node) // pass child custom object if extending the default\n          || extendedObj) {\n            obj.position.x = pos.x;\n            obj.position.y = pos.y || 0;\n            obj.position.z = pos.z || 0;\n          }\n        });\n\n        // Update links position\n        var linkWidthAccessor = accessorFn(state.linkWidth);\n        var linkCurvatureAccessor = accessorFn(state.linkCurvature);\n        var linkCurveRotationAccessor = accessorFn(state.linkCurveRotation);\n        var linkThreeObjectExtendAccessor = accessorFn(state.linkThreeObjectExtend);\n        state.linkDataMapper.entries().forEach(function (_ref3) {\n          var _ref4 = _slicedToArray(_ref3, 2),\n            link = _ref4[0],\n            lineObj = _ref4[1];\n          if (!lineObj) return;\n          var pos = isD3Sim ? link : state.layout.getLinkPosition(state.layout.graph.getLink(link.source, link.target).id);\n          var start = pos[isD3Sim ? 'source' : 'from'];\n          var end = pos[isD3Sim ? 'target' : 'to'];\n          if (!start || !end || !start.hasOwnProperty('x') || !end.hasOwnProperty('x')) return; // skip invalid link\n\n          calcLinkCurve(link); // calculate link curve for all links, including custom replaced, so it can be used in directional functionality\n\n          var extendedObj = linkThreeObjectExtendAccessor(link);\n          if (state.linkPositionUpdate && state.linkPositionUpdate(extendedObj ? lineObj.children[1] : lineObj,\n          // pass child custom object if extending the default\n          {\n            start: {\n              x: start.x,\n              y: start.y,\n              z: start.z\n            },\n            end: {\n              x: end.x,\n              y: end.y,\n              z: end.z\n            }\n          }, link) && !extendedObj) {\n            // exit if successfully custom updated position of non-extended obj\n            return;\n          }\n          var curveResolution = 30; // # line segments\n          var curve = link.__curve;\n\n          // select default line obj if it's an extended group\n          var line = lineObj.children.length ? lineObj.children[0] : lineObj;\n          if (line.type === 'Line') {\n            // Update line geometry\n            if (!curve) {\n              // straight line\n              var linePos = line.geometry.getAttribute('position');\n              if (!linePos || !linePos.array || linePos.array.length !== 6) {\n                line.geometry[setAttributeFn]('position', linePos = new three$1.BufferAttribute(new Float32Array(2 * 3), 3));\n              }\n              linePos.array[0] = start.x;\n              linePos.array[1] = start.y || 0;\n              linePos.array[2] = start.z || 0;\n              linePos.array[3] = end.x;\n              linePos.array[4] = end.y || 0;\n              linePos.array[5] = end.z || 0;\n              linePos.needsUpdate = true;\n            } else {\n              // bezier curve line\n              var curvePnts = curve.getPoints(curveResolution);\n              // resize buffer if needed\n              if (line.geometry.getAttribute('position').array.length !== curvePnts.length * 3) {\n                line.geometry[setAttributeFn]('position', new three$1.BufferAttribute(new Float32Array(curvePnts.length * 3), 3));\n              }\n              line.geometry.setFromPoints(curvePnts);\n            }\n            line.geometry.computeBoundingSphere();\n          } else if (line.type === 'Mesh') {\n            // Update cylinder geometry\n\n            if (!curve) {\n              // straight tube\n              if (!line.geometry.type.match(/^Cylinder(Buffer)?Geometry$/)) {\n                var linkWidth = Math.ceil(linkWidthAccessor(link) * 10) / 10;\n                var r = linkWidth / 2;\n                var geometry = new three$1.CylinderGeometry(r, r, 1, state.linkResolution, 1, false);\n                geometry[applyMatrix4Fn](new three$1.Matrix4().makeTranslation(0, 1 / 2, 0));\n                geometry[applyMatrix4Fn](new three$1.Matrix4().makeRotationX(Math.PI / 2));\n                line.geometry.dispose();\n                line.geometry = geometry;\n              }\n              var vStart = new three$1.Vector3(start.x, start.y || 0, start.z || 0);\n              var vEnd = new three$1.Vector3(end.x, end.y || 0, end.z || 0);\n              var distance = vStart.distanceTo(vEnd);\n              line.position.x = vStart.x;\n              line.position.y = vStart.y;\n              line.position.z = vStart.z;\n              line.scale.z = distance;\n              line.parent.localToWorld(vEnd); // lookAt requires world coords\n              line.lookAt(vEnd);\n            } else {\n              // curved tube\n              if (!line.geometry.type.match(/^Tube(Buffer)?Geometry$/)) {\n                // reset object positioning\n                line.position.set(0, 0, 0);\n                line.rotation.set(0, 0, 0);\n                line.scale.set(1, 1, 1);\n              }\n              var _linkWidth = Math.ceil(linkWidthAccessor(link) * 10) / 10;\n              var _r = _linkWidth / 2;\n              var _geometry = new three$1.TubeGeometry(curve, curveResolution, _r, state.linkResolution, false);\n              line.geometry.dispose();\n              line.geometry = _geometry;\n            }\n          }\n        });\n\n        //\n\n        function calcLinkCurve(link) {\n          var pos = isD3Sim ? link : state.layout.getLinkPosition(state.layout.graph.getLink(link.source, link.target).id);\n          var start = pos[isD3Sim ? 'source' : 'from'];\n          var end = pos[isD3Sim ? 'target' : 'to'];\n          if (!start || !end || !start.hasOwnProperty('x') || !end.hasOwnProperty('x')) return; // skip invalid link\n\n          var curvature = linkCurvatureAccessor(link);\n          if (!curvature) {\n            link.__curve = null; // Straight line\n          } else {\n            // bezier curve line (only for line types)\n            var vStart = new three$1.Vector3(start.x, start.y || 0, start.z || 0);\n            var vEnd = new three$1.Vector3(end.x, end.y || 0, end.z || 0);\n            var l = vStart.distanceTo(vEnd); // line length\n\n            var curve;\n            var curveRotation = linkCurveRotationAccessor(link);\n            if (l > 0) {\n              var dx = end.x - start.x;\n              var dy = end.y - start.y || 0;\n              var vLine = new three$1.Vector3().subVectors(vEnd, vStart);\n              var cp = vLine.clone().multiplyScalar(curvature).cross(dx !== 0 || dy !== 0 ? new three$1.Vector3(0, 0, 1) : new three$1.Vector3(0, 1, 0)) // avoid cross-product of parallel vectors (prefer Z, fallback to Y)\n              .applyAxisAngle(vLine.normalize(), curveRotation) // rotate along line axis according to linkCurveRotation\n              .add(new three$1.Vector3().addVectors(vStart, vEnd).divideScalar(2));\n              curve = new three$1.QuadraticBezierCurve3(vStart, cp, vEnd);\n            } else {\n              // Same point, draw a loop\n              var d = curvature * 70;\n              var endAngle = -curveRotation; // Rotate clockwise (from Z angle perspective)\n              var startAngle = endAngle + Math.PI / 2;\n              curve = new three$1.CubicBezierCurve3(vStart, new three$1.Vector3(d * Math.cos(startAngle), d * Math.sin(startAngle), 0).add(vStart), new three$1.Vector3(d * Math.cos(endAngle), d * Math.sin(endAngle), 0).add(vStart), vEnd);\n            }\n            link.__curve = curve;\n          }\n        }\n      }\n      function updateArrows() {\n        // update link arrow position\n        var arrowRelPosAccessor = accessorFn(state.linkDirectionalArrowRelPos);\n        var arrowLengthAccessor = accessorFn(state.linkDirectionalArrowLength);\n        var nodeValAccessor = accessorFn(state.nodeVal);\n        state.arrowDataMapper.entries().forEach(function (_ref5) {\n          var _ref6 = _slicedToArray(_ref5, 2),\n            link = _ref6[0],\n            arrowObj = _ref6[1];\n          if (!arrowObj) return;\n          var pos = isD3Sim ? link : state.layout.getLinkPosition(state.layout.graph.getLink(link.source, link.target).id);\n          var start = pos[isD3Sim ? 'source' : 'from'];\n          var end = pos[isD3Sim ? 'target' : 'to'];\n          if (!start || !end || !start.hasOwnProperty('x') || !end.hasOwnProperty('x')) return; // skip invalid link\n\n          var startR = Math.cbrt(Math.max(0, nodeValAccessor(start) || 1)) * state.nodeRelSize;\n          var endR = Math.cbrt(Math.max(0, nodeValAccessor(end) || 1)) * state.nodeRelSize;\n          var arrowLength = arrowLengthAccessor(link);\n          var arrowRelPos = arrowRelPosAccessor(link);\n          var getPosAlongLine = link.__curve ? function (t) {\n            return link.__curve.getPoint(t);\n          } // interpolate along bezier curve\n          : function (t) {\n            // straight line: interpolate linearly\n            var iplt = function iplt(dim, start, end, t) {\n              return start[dim] + (end[dim] - start[dim]) * t || 0;\n            };\n            return {\n              x: iplt('x', start, end, t),\n              y: iplt('y', start, end, t),\n              z: iplt('z', start, end, t)\n            };\n          };\n          var lineLen = link.__curve ? link.__curve.getLength() : Math.sqrt(['x', 'y', 'z'].map(function (dim) {\n            return Math.pow((end[dim] || 0) - (start[dim] || 0), 2);\n          }).reduce(function (acc, v) {\n            return acc + v;\n          }, 0));\n          var posAlongLine = startR + arrowLength + (lineLen - startR - endR - arrowLength) * arrowRelPos;\n          var arrowHead = getPosAlongLine(posAlongLine / lineLen);\n          var arrowTail = getPosAlongLine((posAlongLine - arrowLength) / lineLen);\n          ['x', 'y', 'z'].forEach(function (dim) {\n            return arrowObj.position[dim] = arrowTail[dim];\n          });\n          var headVec = _construct(three$1.Vector3, _toConsumableArray(['x', 'y', 'z'].map(function (c) {\n            return arrowHead[c];\n          })));\n          arrowObj.parent.localToWorld(headVec); // lookAt requires world coords\n          arrowObj.lookAt(headVec);\n        });\n      }\n      function updatePhotons() {\n        // update link particle positions\n        var particleSpeedAccessor = accessorFn(state.linkDirectionalParticleSpeed);\n        var particleOffsetAccessor = accessorFn(state.linkDirectionalParticleOffset);\n        state.graphData.links.forEach(function (link) {\n          var photonsObj = state.particlesDataMapper.getObj(link);\n          var cyclePhotons = photonsObj && photonsObj.children;\n          var singleHopPhotons = link.__singleHopPhotonsObj && link.__singleHopPhotonsObj.children;\n          if ((!singleHopPhotons || !singleHopPhotons.length) && (!cyclePhotons || !cyclePhotons.length)) return;\n          var pos = isD3Sim ? link : state.layout.getLinkPosition(state.layout.graph.getLink(link.source, link.target).id);\n          var start = pos[isD3Sim ? 'source' : 'from'];\n          var end = pos[isD3Sim ? 'target' : 'to'];\n          if (!start || !end || !start.hasOwnProperty('x') || !end.hasOwnProperty('x')) return; // skip invalid link\n\n          var particleSpeed = particleSpeedAccessor(link);\n          var particleOffset = Math.abs(particleOffsetAccessor(link));\n          var getPhotonPos = link.__curve ? function (t) {\n            return link.__curve.getPoint(t);\n          } // interpolate along bezier curve\n          : function (t) {\n            // straight line: interpolate linearly\n            var iplt = function iplt(dim, start, end, t) {\n              return start[dim] + (end[dim] - start[dim]) * t || 0;\n            };\n            return {\n              x: iplt('x', start, end, t),\n              y: iplt('y', start, end, t),\n              z: iplt('z', start, end, t)\n            };\n          };\n          var photons = [].concat(_toConsumableArray(cyclePhotons || []), _toConsumableArray(singleHopPhotons || []));\n          photons.forEach(function (photon, idx) {\n            var singleHop = photon.parent.__linkThreeObjType === 'singleHopPhotons';\n            if (!photon.hasOwnProperty('__progressRatio')) {\n              photon.__progressRatio = singleHop ? 0 : (idx + particleOffset) / cyclePhotons.length;\n            }\n            photon.__progressRatio += particleSpeed;\n            if (photon.__progressRatio >= 1) {\n              if (!singleHop) {\n                photon.__progressRatio = photon.__progressRatio % 1;\n              } else {\n                // remove particle\n                photon.parent.remove(photon);\n                emptyObject(photon);\n                return;\n              }\n            }\n            var photonPosRatio = photon.__progressRatio;\n            var pos = getPhotonPos(photonPosRatio);\n\n            // Orient asymmetrical particles to target\n            photon.geometry.type !== 'SphereGeometry' && photon.lookAt(pos.x, pos.y, pos.z);\n            ['x', 'y', 'z'].forEach(function (dim) {\n              return photon.position[dim] = pos[dim];\n            });\n          });\n        });\n      }\n    },\n    emitParticle: function emitParticle(state, link) {\n      if (link && state.graphData.links.includes(link)) {\n        if (!link.__singleHopPhotonsObj) {\n          var obj = new three$1.Group();\n          obj.__linkThreeObjType = 'singleHopPhotons';\n          link.__singleHopPhotonsObj = obj;\n          state.graphScene.add(obj);\n        }\n        var particleObj = accessorFn(state.linkDirectionalParticleThreeObject)(link);\n        if (particleObj && state.linkDirectionalParticleThreeObject === particleObj) {\n          // clone object if it's a shared object among all links\n          particleObj = particleObj.clone();\n        }\n        if (!particleObj) {\n          var particleWidthAccessor = accessorFn(state.linkDirectionalParticleWidth);\n          var photonR = Math.ceil(particleWidthAccessor(link) * 10) / 10 / 2;\n          var numSegments = state.linkDirectionalParticleResolution;\n          var particleGeometry = new three$1.SphereGeometry(photonR, numSegments, numSegments);\n          var linkColorAccessor = accessorFn(state.linkColor);\n          var particleColorAccessor = accessorFn(state.linkDirectionalParticleColor);\n          var photonColor = particleColorAccessor(link) || linkColorAccessor(link) || '#f0f0f0';\n          var materialColor = new three$1.Color(colorStr2Hex(photonColor));\n          var opacity = state.linkOpacity * 3;\n          var particleMaterial = new three$1.MeshLambertMaterial({\n            color: materialColor,\n            transparent: true,\n            opacity: opacity\n          });\n          particleObj = new three$1.Mesh(particleGeometry, particleMaterial);\n        }\n\n        // add a single hop particle\n        link.__singleHopPhotonsObj.add(particleObj);\n      }\n      return this;\n    },\n    getGraphBbox: function getGraphBbox(state) {\n      var nodeFilter = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : function () {\n        return true;\n      };\n      if (!state.initialised) return null;\n\n      // recursively collect all nested geometries bboxes\n      var bboxes = function getBboxes(obj) {\n        var bboxes = [];\n        if (obj.geometry) {\n          obj.geometry.computeBoundingBox();\n          var box = new three$1.Box3();\n          box.copy(obj.geometry.boundingBox).applyMatrix4(obj.matrixWorld);\n          bboxes.push(box);\n        }\n        return bboxes.concat.apply(bboxes, _toConsumableArray((obj.children || []).filter(function (obj) {\n          return !obj.hasOwnProperty('__graphObjType') || obj.__graphObjType === 'node' && nodeFilter(obj.__data);\n        } // exclude filtered out nodes\n        ).map(getBboxes)));\n      }(state.graphScene);\n      if (!bboxes.length) return null;\n\n      // extract global x,y,z min/max\n      return Object.assign.apply(Object, _toConsumableArray(['x', 'y', 'z'].map(function (c) {\n        return _defineProperty({}, c, [min(bboxes, function (bb) {\n          return bb.min[c];\n        }), max(bboxes, function (bb) {\n          return bb.max[c];\n        })]);\n      })));\n    }\n  },\n  stateInit: function stateInit() {\n    return {\n      d3ForceLayout: forceSimulation().force('link', forceLink()).force('charge', forceManyBody()).force('center', forceCenter()).force('dagRadial', null).stop(),\n      engineRunning: false\n    };\n  },\n  init: function init(threeObj, state) {\n    // Main three object to manipulate\n    state.graphScene = threeObj;\n    state.nodeDataMapper = new ThreeDigest(threeObj, {\n      objBindAttr: '__threeObj'\n    });\n    state.linkDataMapper = new ThreeDigest(threeObj, {\n      objBindAttr: '__lineObj'\n    });\n    state.arrowDataMapper = new ThreeDigest(threeObj, {\n      objBindAttr: '__arrowObj'\n    });\n    state.particlesDataMapper = new ThreeDigest(threeObj, {\n      objBindAttr: '__photonsObj'\n    });\n  },\n  update: function update(state, changedProps) {\n    var hasAnyPropChanged = function hasAnyPropChanged(propList) {\n      return propList.some(function (p) {\n        return changedProps.hasOwnProperty(p);\n      });\n    };\n    state.engineRunning = false; // pause simulation\n    typeof state.onUpdate === \"function\" && state.onUpdate();\n    if (state.nodeAutoColorBy !== null && hasAnyPropChanged(['nodeAutoColorBy', 'graphData', 'nodeColor'])) {\n      // Auto add color to uncolored nodes\n      autoColorObjects(state.graphData.nodes, accessorFn(state.nodeAutoColorBy), state.nodeColor);\n    }\n    if (state.linkAutoColorBy !== null && hasAnyPropChanged(['linkAutoColorBy', 'graphData', 'linkColor'])) {\n      // Auto add color to uncolored links\n      autoColorObjects(state.graphData.links, accessorFn(state.linkAutoColorBy), state.linkColor);\n    }\n\n    // Digest nodes WebGL objects\n    if (state._flushObjects || hasAnyPropChanged(['graphData', 'nodeThreeObject', 'nodeThreeObjectExtend', 'nodeVal', 'nodeColor', 'nodeVisibility', 'nodeRelSize', 'nodeResolution', 'nodeOpacity'])) {\n      var customObjectAccessor = accessorFn(state.nodeThreeObject);\n      var customObjectExtendAccessor = accessorFn(state.nodeThreeObjectExtend);\n      var valAccessor = accessorFn(state.nodeVal);\n      var colorAccessor = accessorFn(state.nodeColor);\n      var visibilityAccessor = accessorFn(state.nodeVisibility);\n      var sphereGeometries = {}; // indexed by node value\n      var sphereMaterials = {}; // indexed by color\n\n      if (state._flushObjects || hasAnyPropChanged([\n      // recreate objects if any of these props have changed\n      'nodeThreeObject', 'nodeThreeObjectExtend'])) state.nodeDataMapper.clear();\n      state.nodeDataMapper.onCreateObj(function (node) {\n        var customObj = customObjectAccessor(node);\n        var extendObj = customObjectExtendAccessor(node);\n        if (customObj && state.nodeThreeObject === customObj) {\n          // clone object if it's a shared object among all nodes\n          customObj = customObj.clone();\n        }\n        var obj;\n        if (customObj && !extendObj) {\n          obj = customObj;\n        } else {\n          // Add default object (sphere mesh)\n          obj = new three$1.Mesh();\n          obj.__graphDefaultObj = true;\n          if (customObj && extendObj) {\n            obj.add(customObj); // extend default with custom\n          }\n        }\n        obj.__graphObjType = 'node'; // Add object type\n\n        return obj;\n      }).onUpdateObj(function (obj, node) {\n        if (obj.__graphDefaultObj) {\n          // bypass internal updates for custom node objects\n          var val = valAccessor(node) || 1;\n          var radius = Math.cbrt(val) * state.nodeRelSize;\n          var numSegments = state.nodeResolution;\n          if (!obj.geometry.type.match(/^Sphere(Buffer)?Geometry$/) || obj.geometry.parameters.radius !== radius || obj.geometry.parameters.widthSegments !== numSegments) {\n            if (!sphereGeometries.hasOwnProperty(val)) {\n              sphereGeometries[val] = new three$1.SphereGeometry(radius, numSegments, numSegments);\n            }\n            obj.geometry.dispose();\n            obj.geometry = sphereGeometries[val];\n          }\n          var color = colorAccessor(node);\n          var materialColor = new three$1.Color(colorStr2Hex(color || '#ffffaa'));\n          var opacity = state.nodeOpacity * colorAlpha(color);\n          if (obj.material.type !== 'MeshLambertMaterial' || !obj.material.color.equals(materialColor) || obj.material.opacity !== opacity) {\n            if (!sphereMaterials.hasOwnProperty(color)) {\n              sphereMaterials[color] = new three$1.MeshLambertMaterial({\n                color: materialColor,\n                transparent: true,\n                opacity: opacity\n              });\n            }\n            obj.material.dispose();\n            obj.material = sphereMaterials[color];\n          }\n        }\n      }).digest(state.graphData.nodes.filter(visibilityAccessor));\n    }\n\n    // Digest links WebGL objects\n    if (state._flushObjects || hasAnyPropChanged(['graphData', 'linkThreeObject', 'linkThreeObjectExtend', 'linkMaterial', 'linkColor', 'linkWidth', 'linkVisibility', 'linkResolution', 'linkOpacity', 'linkDirectionalArrowLength', 'linkDirectionalArrowColor', 'linkDirectionalArrowResolution', 'linkDirectionalParticles', 'linkDirectionalParticleWidth', 'linkDirectionalParticleColor', 'linkDirectionalParticleResolution', 'linkDirectionalParticleThreeObject'])) {\n      var _customObjectAccessor = accessorFn(state.linkThreeObject);\n      var _customObjectExtendAccessor = accessorFn(state.linkThreeObjectExtend);\n      var customMaterialAccessor = accessorFn(state.linkMaterial);\n      var _visibilityAccessor = accessorFn(state.linkVisibility);\n      var _colorAccessor = accessorFn(state.linkColor);\n      var widthAccessor = accessorFn(state.linkWidth);\n      var cylinderGeometries = {}; // indexed by link width\n      var lambertLineMaterials = {}; // for cylinder objects, indexed by link color\n      var basicLineMaterials = {}; // for line objects, indexed by link color\n\n      var visibleLinks = state.graphData.links.filter(_visibilityAccessor);\n\n      // lines digest cycle\n      if (state._flushObjects || hasAnyPropChanged([\n      // recreate objects if any of these props have changed\n      'linkThreeObject', 'linkThreeObjectExtend', 'linkWidth'])) state.linkDataMapper.clear();\n      state.linkDataMapper.onRemoveObj(function (obj) {\n        // remove trailing single photons\n        var singlePhotonsObj = obj.__data && obj.__data.__singleHopPhotonsObj;\n        if (singlePhotonsObj) {\n          singlePhotonsObj.parent.remove(singlePhotonsObj);\n          emptyObject(singlePhotonsObj);\n          delete obj.__data.__singleHopPhotonsObj;\n        }\n      }).onCreateObj(function (link) {\n        var customObj = _customObjectAccessor(link);\n        var extendObj = _customObjectExtendAccessor(link);\n        if (customObj && state.linkThreeObject === customObj) {\n          // clone object if it's a shared object among all links\n          customObj = customObj.clone();\n        }\n        var defaultObj;\n        if (!customObj || extendObj) {\n          // construct default line obj\n          var useCylinder = !!widthAccessor(link);\n          if (useCylinder) {\n            defaultObj = new three$1.Mesh();\n          } else {\n            // Use plain line (constant width)\n            var lineGeometry = new three$1.BufferGeometry();\n            lineGeometry[setAttributeFn]('position', new three$1.BufferAttribute(new Float32Array(2 * 3), 3));\n            defaultObj = new three$1.Line(lineGeometry);\n          }\n        }\n        var obj;\n        if (!customObj) {\n          obj = defaultObj;\n          obj.__graphDefaultObj = true;\n        } else {\n          if (!extendObj) {\n            // use custom object\n            obj = customObj;\n          } else {\n            // extend default with custom in a group\n            obj = new three$1.Group();\n            obj.__graphDefaultObj = true;\n            obj.add(defaultObj);\n            obj.add(customObj);\n          }\n        }\n        obj.renderOrder = 10; // Prevent visual glitches of dark lines on top of nodes by rendering them last\n\n        obj.__graphObjType = 'link'; // Add object type\n\n        return obj;\n      }).onUpdateObj(function (updObj, link) {\n        if (updObj.__graphDefaultObj) {\n          // bypass internal updates for custom link objects\n          // select default object if it's an extended group\n          var obj = updObj.children.length ? updObj.children[0] : updObj;\n          var linkWidth = Math.ceil(widthAccessor(link) * 10) / 10;\n          var useCylinder = !!linkWidth;\n          if (useCylinder) {\n            var r = linkWidth / 2;\n            var numSegments = state.linkResolution;\n            if (!obj.geometry.type.match(/^Cylinder(Buffer)?Geometry$/) || obj.geometry.parameters.radiusTop !== r || obj.geometry.parameters.radialSegments !== numSegments) {\n              if (!cylinderGeometries.hasOwnProperty(linkWidth)) {\n                var geometry = new three$1.CylinderGeometry(r, r, 1, numSegments, 1, false);\n                geometry[applyMatrix4Fn](new three$1.Matrix4().makeTranslation(0, 1 / 2, 0));\n                geometry[applyMatrix4Fn](new three$1.Matrix4().makeRotationX(Math.PI / 2));\n                cylinderGeometries[linkWidth] = geometry;\n              }\n              obj.geometry.dispose();\n              obj.geometry = cylinderGeometries[linkWidth];\n            }\n          }\n          var customMaterial = customMaterialAccessor(link);\n          if (customMaterial) {\n            obj.material = customMaterial;\n          } else {\n            var color = _colorAccessor(link);\n            var materialColor = new three$1.Color(colorStr2Hex(color || '#f0f0f0'));\n            var opacity = state.linkOpacity * colorAlpha(color);\n            var materialType = useCylinder ? 'MeshLambertMaterial' : 'LineBasicMaterial';\n            if (obj.material.type !== materialType || !obj.material.color.equals(materialColor) || obj.material.opacity !== opacity) {\n              var lineMaterials = useCylinder ? lambertLineMaterials : basicLineMaterials;\n              if (!lineMaterials.hasOwnProperty(color)) {\n                lineMaterials[color] = new three$1[materialType]({\n                  color: materialColor,\n                  transparent: opacity < 1,\n                  opacity: opacity,\n                  depthWrite: opacity >= 1 // Prevent transparency issues\n                });\n              }\n              obj.material.dispose();\n              obj.material = lineMaterials[color];\n            }\n          }\n        }\n      }).digest(visibleLinks);\n\n      // Arrows digest cycle\n      if (state.linkDirectionalArrowLength || changedProps.hasOwnProperty('linkDirectionalArrowLength')) {\n        var arrowLengthAccessor = accessorFn(state.linkDirectionalArrowLength);\n        var arrowColorAccessor = accessorFn(state.linkDirectionalArrowColor);\n        state.arrowDataMapper.onCreateObj(function () {\n          var obj = new three$1.Mesh(undefined, new three$1.MeshLambertMaterial({\n            transparent: true\n          }));\n          obj.__linkThreeObjType = 'arrow'; // Add object type\n\n          return obj;\n        }).onUpdateObj(function (obj, link) {\n          var arrowLength = arrowLengthAccessor(link);\n          var numSegments = state.linkDirectionalArrowResolution;\n          if (!obj.geometry.type.match(/^Cone(Buffer)?Geometry$/) || obj.geometry.parameters.height !== arrowLength || obj.geometry.parameters.radialSegments !== numSegments) {\n            var coneGeometry = new three$1.ConeGeometry(arrowLength * 0.25, arrowLength, numSegments);\n            // Correct orientation\n            coneGeometry.translate(0, arrowLength / 2, 0);\n            coneGeometry.rotateX(Math.PI / 2);\n            obj.geometry.dispose();\n            obj.geometry = coneGeometry;\n          }\n          var arrowColor = arrowColorAccessor(link) || _colorAccessor(link) || '#f0f0f0';\n          obj.material.color = new three$1.Color(colorStr2Hex(arrowColor));\n          obj.material.opacity = state.linkOpacity * 3 * colorAlpha(arrowColor);\n        }).digest(visibleLinks.filter(arrowLengthAccessor));\n      }\n\n      // Photon particles digest cycle\n      if (state.linkDirectionalParticles || changedProps.hasOwnProperty('linkDirectionalParticles')) {\n        var particlesAccessor = accessorFn(state.linkDirectionalParticles);\n        var particleWidthAccessor = accessorFn(state.linkDirectionalParticleWidth);\n        var particleColorAccessor = accessorFn(state.linkDirectionalParticleColor);\n        var particleObjectAccessor = accessorFn(state.linkDirectionalParticleThreeObject);\n        var particleMaterials = {}; // indexed by link color\n        var particleGeometries = {}; // indexed by particle width\n\n        state.particlesDataMapper.onCreateObj(function () {\n          var obj = new three$1.Group();\n          obj.__linkThreeObjType = 'photons'; // Add object type\n\n          obj.__photonDataMapper = new ThreeDigest(obj);\n          return obj;\n        }).onUpdateObj(function (obj, link) {\n          var curPhoton = !!obj.children.length && obj.children[0];\n          var customObj = particleObjectAccessor(link);\n          var particleGeometry, particleMaterial;\n          if (customObj) {\n            particleGeometry = customObj.geometry;\n            particleMaterial = customObj.material;\n          } else {\n            var photonR = Math.ceil(particleWidthAccessor(link) * 10) / 10 / 2;\n            var numSegments = state.linkDirectionalParticleResolution;\n            if (curPhoton && curPhoton.geometry.parameters.radius === photonR && curPhoton.geometry.parameters.widthSegments === numSegments) {\n              particleGeometry = curPhoton.geometry;\n            } else {\n              if (!particleGeometries.hasOwnProperty(photonR)) {\n                particleGeometries[photonR] = new three$1.SphereGeometry(photonR, numSegments, numSegments);\n              }\n              particleGeometry = particleGeometries[photonR];\n            }\n            var photonColor = particleColorAccessor(link) || _colorAccessor(link) || '#f0f0f0';\n            var materialColor = new three$1.Color(colorStr2Hex(photonColor));\n            var opacity = state.linkOpacity * 3;\n            if (curPhoton && curPhoton.material.color.equals(materialColor) && curPhoton.material.opacity === opacity) {\n              particleMaterial = curPhoton.material;\n            } else {\n              if (!particleMaterials.hasOwnProperty(photonColor)) {\n                particleMaterials[photonColor] = new three$1.MeshLambertMaterial({\n                  color: materialColor,\n                  transparent: true,\n                  opacity: opacity\n                });\n              }\n              particleMaterial = particleMaterials[photonColor];\n            }\n          }\n          if (curPhoton) {\n            // Dispose of previous particles\n            curPhoton.geometry !== particleGeometry && curPhoton.geometry.dispose();\n            curPhoton.material !== particleMaterial && curPhoton.material.dispose();\n          }\n\n          // digest cycle for each photon\n          var numPhotons = Math.round(Math.abs(particlesAccessor(link)));\n          obj.__photonDataMapper.id(function (d) {\n            return d.idx;\n          }).onCreateObj(function () {\n            return new three$1.Mesh(particleGeometry, particleMaterial);\n          }).onUpdateObj(function (obj) {\n            obj.geometry = particleGeometry;\n            obj.material = particleMaterial;\n          }).digest(_toConsumableArray(new Array(numPhotons)).map(function (_, idx) {\n            return {\n              idx: idx\n            };\n          }));\n        }).digest(visibleLinks.filter(particlesAccessor));\n      }\n    }\n    state._flushObjects = false; // reset objects refresh flag\n\n    // simulation engine\n    if (hasAnyPropChanged(['graphData', 'nodeId', 'linkSource', 'linkTarget', 'numDimensions', 'forceEngine', 'dagMode', 'dagNodeFilter', 'dagLevelDistance'])) {\n      state.engineRunning = false; // Pause simulation\n\n      // parse links\n      state.graphData.links.forEach(function (link) {\n        link.source = link[state.linkSource];\n        link.target = link[state.linkTarget];\n      });\n\n      // Feed data to force-directed layout\n      var isD3Sim = state.forceEngine !== 'ngraph';\n      var layout;\n      if (isD3Sim) {\n        // D3-force\n        (layout = state.d3ForceLayout).stop().alpha(1) // re-heat the simulation\n        .numDimensions(state.numDimensions).nodes(state.graphData.nodes);\n\n        // add links (if link force is still active)\n        var linkForce = state.d3ForceLayout.force('link');\n        if (linkForce) {\n          linkForce.id(function (d) {\n            return d[state.nodeId];\n          }).links(state.graphData.links);\n        }\n\n        // setup dag force constraints\n        var nodeDepths = state.dagMode && getDagDepths(state.graphData, function (node) {\n          return node[state.nodeId];\n        }, {\n          nodeFilter: state.dagNodeFilter,\n          onLoopError: state.onDagError || undefined\n        });\n        var maxDepth = Math.max.apply(Math, _toConsumableArray(Object.values(nodeDepths || [])));\n        var dagLevelDistance = state.dagLevelDistance || state.graphData.nodes.length / (maxDepth || 1) * DAG_LEVEL_NODE_RATIO * (['radialin', 'radialout'].indexOf(state.dagMode) !== -1 ? 0.7 : 1);\n\n        // Reset relevant f* when swapping dag modes\n        if (['lr', 'rl', 'td', 'bu', 'zin', 'zout'].includes(changedProps.dagMode)) {\n          var resetProp = ['lr', 'rl'].includes(changedProps.dagMode) ? 'fx' : ['td', 'bu'].includes(changedProps.dagMode) ? 'fy' : 'fz';\n          state.graphData.nodes.filter(state.dagNodeFilter).forEach(function (node) {\n            return delete node[resetProp];\n          });\n        }\n\n        // Fix nodes to x,y,z for dag mode\n        if (['lr', 'rl', 'td', 'bu', 'zin', 'zout'].includes(state.dagMode)) {\n          var invert = ['rl', 'td', 'zout'].includes(state.dagMode);\n          var fixFn = function fixFn(node) {\n            return (nodeDepths[node[state.nodeId]] - maxDepth / 2) * dagLevelDistance * (invert ? -1 : 1);\n          };\n          var _resetProp = ['lr', 'rl'].includes(state.dagMode) ? 'fx' : ['td', 'bu'].includes(state.dagMode) ? 'fy' : 'fz';\n          state.graphData.nodes.filter(state.dagNodeFilter).forEach(function (node) {\n            return node[_resetProp] = fixFn(node);\n          });\n        }\n\n        // Use radial force for radial dags\n        state.d3ForceLayout.force('dagRadial', ['radialin', 'radialout'].indexOf(state.dagMode) !== -1 ? forceRadial(function (node) {\n          var nodeDepth = nodeDepths[node[state.nodeId]] || -1;\n          return (state.dagMode === 'radialin' ? maxDepth - nodeDepth : nodeDepth) * dagLevelDistance;\n        }).strength(function (node) {\n          return state.dagNodeFilter(node) ? 1 : 0;\n        }) : null);\n      } else {\n        // ngraph\n        var _graph = ngraph.graph();\n        state.graphData.nodes.forEach(function (node) {\n          _graph.addNode(node[state.nodeId]);\n        });\n        state.graphData.links.forEach(function (link) {\n          _graph.addLink(link.source, link.target);\n        });\n        layout = ngraph.forcelayout(_graph, _objectSpread2({\n          dimensions: state.numDimensions\n        }, state.ngraphPhysics));\n        layout.graph = _graph; // Attach graph reference to layout\n      }\n      for (var i = 0; i < state.warmupTicks && !(isD3Sim && state.d3AlphaMin > 0 && state.d3ForceLayout.alpha() < state.d3AlphaMin); i++) {\n        layout[isD3Sim ? \"tick\" : \"step\"]();\n      } // Initial ticks before starting to render\n\n      state.layout = layout;\n      this.resetCountdown();\n    }\n    state.engineRunning = true; // resume simulation\n\n    state.onFinishUpdate();\n  }\n});\nfunction fromKapsule(kapsule) {\n  var baseClass = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : Object;\n  var initKapsuleWithSelf = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : false;\n  var ForceGraph = /*#__PURE__*/function (_baseClass) {\n    function ForceGraph() {\n      var _this;\n      _classCallCheck(this, ForceGraph);\n      for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n        args[_key] = arguments[_key];\n      }\n      _this = _callSuper(this, ForceGraph, [].concat(args));\n      _this.__kapsuleInstance = _construct(kapsule, [].concat(_toConsumableArray(initKapsuleWithSelf ? [_this] : []), args));\n      return _this;\n    }\n    _inherits(ForceGraph, _baseClass);\n    return _createClass(ForceGraph);\n  }(baseClass); // attach kapsule props/methods to class prototype\n  Object.keys(kapsule()).forEach(function (m) {\n    return ForceGraph.prototype[m] = function () {\n      var _this$__kapsuleInstan;\n      var returnVal = (_this$__kapsuleInstan = this.__kapsuleInstance)[m].apply(_this$__kapsuleInstan, arguments);\n      return returnVal === this.__kapsuleInstance ? this // chain based on this class, not the kapsule obj\n      : returnVal;\n    };\n  });\n  return ForceGraph;\n}\nvar three = window.THREE ? window.THREE : {\n  Group: Group\n}; // Prefer consumption from global THREE, if exists\nvar threeForcegraph = fromKapsule(ForceGraph, three.Group, true);\nexport { threeForcegraph as default };","map":{"version":3,"names":["BufferGeometry","Mesh","SphereGeometry","Color","MeshLambertMaterial","BufferAttribute","Line","Group","CylinderGeometry","Matrix4","Box3","CubicBezierCurve3","QuadraticBezierCurve3","LineBasicMaterial","ConeGeometry","TubeGeometry","Vector3","forceRadial","forceSimulation","forceLink","forceManyBody","forceCenter","graph","forcelayout","Kapsule","accessorFn","min","max","DataBindMapper","scaleOrdinal","schemePaired","tinyColor","_arrayLikeToArray","r","a","length","e","n","Array","_arrayWithHoles","isArray","_arrayWithoutHoles","_assertClassBrand","t","has","arguments","TypeError","_assertThisInitialized","ReferenceError","_callSuper","o","_getPrototypeOf","_possibleConstructorReturn","_isNativeReflectConstruct","Reflect","construct","constructor","apply","_checkPrivateRedeclaration","_classCallCheck","_classPrivateFieldGet2","s","get","_classPrivateFieldInitSpec","set","_classPrivateFieldSet2","_construct","push","p","bind","_defineProperties","enumerable","configurable","writable","Object","defineProperty","_toPropertyKey","key","_createClass","prototype","_defineProperty","value","_get","_superPropBase","getOwnPropertyDescriptor","call","setPrototypeOf","getPrototypeOf","__proto__","_inherits","create","_setPrototypeOf","Boolean","valueOf","_iterableToArray","Symbol","iterator","from","_iterableToArrayLimit","l","i","u","f","next","done","return","_nonIterableRest","_nonIterableSpread","ownKeys","keys","getOwnPropertySymbols","filter","_objectSpread2","forEach","getOwnPropertyDescriptors","defineProperties","_slicedToArray","_unsupportedIterableToArray","hasOwnProperty","_superPropGet","_toConsumableArray","_toPrimitive","toPrimitive","String","Number","_typeof","toString","slice","name","test","_materialDispose","materialDispose","material","map","dispose","_deallocate","deallocate","obj","geometry","texture","children","emptyObject","childObj","remove","_dataBindAttr","WeakMap","_objBindAttr","ThreeDigest","_DataBindMapper","scene","_this","_ref","undefined","_ref$dataBindAttr","dataBindAttr","_ref$objBindAttr","objBindAttr","onRemoveObj","onCreateObj","fn","_this2","d","add","_this3","dId","colorStr2Hex","str","isNaN","parseInt","toHex","colorAlpha","getAlpha","autoColorScale","autoColorObjects","objects","colorByAccessor","colorField","getDagDepths","idAccessor","nodes","links","_ref2","_ref2$nodeFilter","nodeFilter","_ref2$onLoopError","onLoopError","loopIds","concat","join","node","data","out","depth","skip","_ref3","source","target","sourceId","getNodeId","targetId","sourceNode","targetNode","foundLoops","traverse","values","nodeDepths","assign","entries","_ref4","_ref5","_ref6","_ref7","id","nodeStack","currentDepth","_loop","indexOf","loop","some","foundLoop","every","idx","three$1","window","THREE","ngraph","DAG_LEVEL_NODE_RATIO","setAttributeFn","setAttribute","applyMatrix4Fn","applyMatrix4","ForceGraph","props","jsonUrl","onChange","state","fetchingJson","onLoading","fetch","then","json","onFinishLoading","graphData","triggerUpdate","engineRunning","numDimensions","numDim","chargeForce","d3ForceLayout","force","strength","eraseDimension","dim","dagMode","forceEngine","fx","fy","fz","dagLevelDistance","dagNodeFilter","_default","onDagError","nodeRelSize","nodeId","nodeVal","nodeResolution","nodeColor","nodeAutoColorBy","nodeOpacity","nodeVisibility","nodeThreeObject","nodeThreeObjectExtend","nodePositionUpdate","linkSource","linkTarget","linkVisibility","linkColor","linkAutoColorBy","linkOpacity","linkWidth","linkResolution","linkCurvature","linkCurveRotation","linkMaterial","linkThreeObject","linkThreeObjectExtend","linkPositionUpdate","linkDirectionalArrowLength","linkDirectionalArrowColor","linkDirectionalArrowRelPos","linkDirectionalArrowResolution","linkDirectionalParticles","linkDirectionalParticleSpeed","linkDirectionalParticleOffset","linkDirectionalParticleWidth","linkDirectionalParticleColor","linkDirectionalParticleResolution","linkDirectionalParticleThreeObject","d3AlphaMin","d3AlphaDecay","alphaDecay","d3AlphaTarget","alphaTarget","d3VelocityDecay","velocityDecay","ngraphPhysics","timeStep","gravity","theta","springLength","springCoefficient","dragCoefficient","warmupTicks","cooldownTicks","Infinity","cooldownTime","onUpdate","onFinishUpdate","onEngineTick","onEngineStop","methods","refresh","_flushObjects","_rerender","d3Force","forceName","forceFn","d3ReheatSimulation","alpha","resetCountdown","cntTicks","startTickTime","Date","tickFrame","isD3Sim","layoutTick","updateArrows","updatePhotons","layout","nodeThreeObjectExtendAccessor","nodeDataMapper","pos","getNodePosition","extendedObj","x","y","z","position","linkWidthAccessor","linkCurvatureAccessor","linkCurveRotationAccessor","linkThreeObjectExtendAccessor","linkDataMapper","link","lineObj","getLinkPosition","getLink","start","end","calcLinkCurve","curveResolution","curve","__curve","line","type","linePos","getAttribute","array","Float32Array","needsUpdate","curvePnts","getPoints","setFromPoints","computeBoundingSphere","match","Math","ceil","makeTranslation","makeRotationX","PI","vStart","vEnd","distance","distanceTo","scale","parent","localToWorld","lookAt","rotation","_linkWidth","_r","_geometry","curvature","curveRotation","dx","dy","vLine","subVectors","cp","clone","multiplyScalar","cross","applyAxisAngle","normalize","addVectors","divideScalar","endAngle","startAngle","cos","sin","arrowRelPosAccessor","arrowLengthAccessor","nodeValAccessor","arrowDataMapper","arrowObj","startR","cbrt","endR","arrowLength","arrowRelPos","getPosAlongLine","getPoint","iplt","lineLen","getLength","sqrt","pow","reduce","acc","v","posAlongLine","arrowHead","arrowTail","headVec","c","particleSpeedAccessor","particleOffsetAccessor","photonsObj","particlesDataMapper","getObj","cyclePhotons","singleHopPhotons","__singleHopPhotonsObj","particleSpeed","particleOffset","abs","getPhotonPos","photons","photon","singleHop","__linkThreeObjType","__progressRatio","photonPosRatio","emitParticle","includes","graphScene","particleObj","particleWidthAccessor","photonR","numSegments","particleGeometry","linkColorAccessor","particleColorAccessor","photonColor","materialColor","opacity","particleMaterial","color","transparent","getGraphBbox","initialised","bboxes","getBboxes","computeBoundingBox","box","copy","boundingBox","matrixWorld","__graphObjType","__data","bb","stateInit","stop","init","threeObj","update","changedProps","hasAnyPropChanged","propList","customObjectAccessor","customObjectExtendAccessor","valAccessor","colorAccessor","visibilityAccessor","sphereGeometries","sphereMaterials","clear","customObj","extendObj","__graphDefaultObj","onUpdateObj","val","radius","parameters","widthSegments","equals","digest","_customObjectAccessor","_customObjectExtendAccessor","customMaterialAccessor","_visibilityAccessor","_colorAccessor","widthAccessor","cylinderGeometries","lambertLineMaterials","basicLineMaterials","visibleLinks","singlePhotonsObj","defaultObj","useCylinder","lineGeometry","renderOrder","updObj","radiusTop","radialSegments","customMaterial","materialType","lineMaterials","depthWrite","arrowColorAccessor","height","coneGeometry","translate","rotateX","arrowColor","particlesAccessor","particleObjectAccessor","particleMaterials","particleGeometries","__photonDataMapper","curPhoton","numPhotons","round","_","linkForce","maxDepth","resetProp","invert","fixFn","_resetProp","nodeDepth","_graph","addNode","addLink","dimensions","fromKapsule","kapsule","baseClass","initKapsuleWithSelf","_baseClass","_len","args","_key","__kapsuleInstance","m","_this$__kapsuleInstan","returnVal","three","threeForcegraph","default"],"sources":["/Users/dimitrischatzopoulos/Desktop/dais/node_modules/three-forcegraph/dist/three-forcegraph.mjs"],"sourcesContent":["import { BufferGeometry, Mesh, SphereGeometry, Color, MeshLambertMaterial, BufferAttribute, Line, Group, CylinderGeometry, Matrix4, Box3, CubicBezierCurve3, QuadraticBezierCurve3, LineBasicMaterial, ConeGeometry, TubeGeometry, Vector3 } from 'three';\nimport { forceRadial, forceSimulation, forceLink, forceManyBody, forceCenter } from 'd3-force-3d';\nimport graph from 'ngraph.graph';\nimport forcelayout from 'ngraph.forcelayout';\nimport Kapsule from 'kapsule';\nimport accessorFn from 'accessor-fn';\nimport { min, max } from 'd3-array';\nimport DataBindMapper from 'data-bind-mapper';\nimport { scaleOrdinal } from 'd3-scale';\nimport { schemePaired } from 'd3-scale-chromatic';\nimport tinyColor from 'tinycolor2';\n\nfunction _arrayLikeToArray(r, a) {\n  (null == a || a > r.length) && (a = r.length);\n  for (var e = 0, n = Array(a); e < a; e++) n[e] = r[e];\n  return n;\n}\nfunction _arrayWithHoles(r) {\n  if (Array.isArray(r)) return r;\n}\nfunction _arrayWithoutHoles(r) {\n  if (Array.isArray(r)) return _arrayLikeToArray(r);\n}\nfunction _assertClassBrand(e, t, n) {\n  if (\"function\" == typeof e ? e === t : e.has(t)) return arguments.length < 3 ? t : n;\n  throw new TypeError(\"Private element is not present on this object\");\n}\nfunction _assertThisInitialized(e) {\n  if (void 0 === e) throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");\n  return e;\n}\nfunction _callSuper(t, o, e) {\n  return o = _getPrototypeOf(o), _possibleConstructorReturn(t, _isNativeReflectConstruct() ? Reflect.construct(o, e || [], _getPrototypeOf(t).constructor) : o.apply(t, e));\n}\nfunction _checkPrivateRedeclaration(e, t) {\n  if (t.has(e)) throw new TypeError(\"Cannot initialize the same private elements twice on an object\");\n}\nfunction _classCallCheck(a, n) {\n  if (!(a instanceof n)) throw new TypeError(\"Cannot call a class as a function\");\n}\nfunction _classPrivateFieldGet2(s, a) {\n  return s.get(_assertClassBrand(s, a));\n}\nfunction _classPrivateFieldInitSpec(e, t, a) {\n  _checkPrivateRedeclaration(e, t), t.set(e, a);\n}\nfunction _classPrivateFieldSet2(s, a, r) {\n  return s.set(_assertClassBrand(s, a), r), r;\n}\nfunction _construct(t, e, r) {\n  if (_isNativeReflectConstruct()) return Reflect.construct.apply(null, arguments);\n  var o = [null];\n  o.push.apply(o, e);\n  var p = new (t.bind.apply(t, o))();\n  return p;\n}\nfunction _defineProperties(e, r) {\n  for (var t = 0; t < r.length; t++) {\n    var o = r[t];\n    o.enumerable = o.enumerable || false, o.configurable = true, \"value\" in o && (o.writable = true), Object.defineProperty(e, _toPropertyKey(o.key), o);\n  }\n}\nfunction _createClass(e, r, t) {\n  return r && _defineProperties(e.prototype, r), Object.defineProperty(e, \"prototype\", {\n    writable: false\n  }), e;\n}\nfunction _defineProperty(e, r, t) {\n  return (r = _toPropertyKey(r)) in e ? Object.defineProperty(e, r, {\n    value: t,\n    enumerable: true,\n    configurable: true,\n    writable: true\n  }) : e[r] = t, e;\n}\nfunction _get() {\n  return _get = \"undefined\" != typeof Reflect && Reflect.get ? Reflect.get.bind() : function (e, t, r) {\n    var p = _superPropBase(e, t);\n    if (p) {\n      var n = Object.getOwnPropertyDescriptor(p, t);\n      return n.get ? n.get.call(arguments.length < 3 ? e : r) : n.value;\n    }\n  }, _get.apply(null, arguments);\n}\nfunction _getPrototypeOf(t) {\n  return _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf.bind() : function (t) {\n    return t.__proto__ || Object.getPrototypeOf(t);\n  }, _getPrototypeOf(t);\n}\nfunction _inherits(t, e) {\n  if (\"function\" != typeof e && null !== e) throw new TypeError(\"Super expression must either be null or a function\");\n  t.prototype = Object.create(e && e.prototype, {\n    constructor: {\n      value: t,\n      writable: true,\n      configurable: true\n    }\n  }), Object.defineProperty(t, \"prototype\", {\n    writable: false\n  }), e && _setPrototypeOf(t, e);\n}\nfunction _isNativeReflectConstruct() {\n  try {\n    var t = !Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {}));\n  } catch (t) {}\n  return (_isNativeReflectConstruct = function () {\n    return !!t;\n  })();\n}\nfunction _iterableToArray(r) {\n  if (\"undefined\" != typeof Symbol && null != r[Symbol.iterator] || null != r[\"@@iterator\"]) return Array.from(r);\n}\nfunction _iterableToArrayLimit(r, l) {\n  var t = null == r ? null : \"undefined\" != typeof Symbol && r[Symbol.iterator] || r[\"@@iterator\"];\n  if (null != t) {\n    var e,\n      n,\n      i,\n      u,\n      a = [],\n      f = true,\n      o = false;\n    try {\n      if (i = (t = t.call(r)).next, 0 === l) ; else for (; !(f = (e = i.call(t)).done) && (a.push(e.value), a.length !== l); f = !0);\n    } catch (r) {\n      o = true, n = r;\n    } finally {\n      try {\n        if (!f && null != t.return && (u = t.return(), Object(u) !== u)) return;\n      } finally {\n        if (o) throw n;\n      }\n    }\n    return a;\n  }\n}\nfunction _nonIterableRest() {\n  throw new TypeError(\"Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n}\nfunction _nonIterableSpread() {\n  throw new TypeError(\"Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n}\nfunction ownKeys(e, r) {\n  var t = Object.keys(e);\n  if (Object.getOwnPropertySymbols) {\n    var o = Object.getOwnPropertySymbols(e);\n    r && (o = o.filter(function (r) {\n      return Object.getOwnPropertyDescriptor(e, r).enumerable;\n    })), t.push.apply(t, o);\n  }\n  return t;\n}\nfunction _objectSpread2(e) {\n  for (var r = 1; r < arguments.length; r++) {\n    var t = null != arguments[r] ? arguments[r] : {};\n    r % 2 ? ownKeys(Object(t), true).forEach(function (r) {\n      _defineProperty(e, r, t[r]);\n    }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(e, Object.getOwnPropertyDescriptors(t)) : ownKeys(Object(t)).forEach(function (r) {\n      Object.defineProperty(e, r, Object.getOwnPropertyDescriptor(t, r));\n    });\n  }\n  return e;\n}\nfunction _possibleConstructorReturn(t, e) {\n  if (e && (\"object\" == typeof e || \"function\" == typeof e)) return e;\n  if (void 0 !== e) throw new TypeError(\"Derived constructors may only return object or undefined\");\n  return _assertThisInitialized(t);\n}\nfunction _setPrototypeOf(t, e) {\n  return _setPrototypeOf = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function (t, e) {\n    return t.__proto__ = e, t;\n  }, _setPrototypeOf(t, e);\n}\nfunction _slicedToArray(r, e) {\n  return _arrayWithHoles(r) || _iterableToArrayLimit(r, e) || _unsupportedIterableToArray(r, e) || _nonIterableRest();\n}\nfunction _superPropBase(t, o) {\n  for (; !{}.hasOwnProperty.call(t, o) && null !== (t = _getPrototypeOf(t)););\n  return t;\n}\nfunction _superPropGet(t, o, e, r) {\n  var p = _get(_getPrototypeOf(t.prototype ), o, e);\n  return \"function\" == typeof p ? function (t) {\n    return p.apply(e, t);\n  } : p;\n}\nfunction _toConsumableArray(r) {\n  return _arrayWithoutHoles(r) || _iterableToArray(r) || _unsupportedIterableToArray(r) || _nonIterableSpread();\n}\nfunction _toPrimitive(t, r) {\n  if (\"object\" != typeof t || !t) return t;\n  var e = t[Symbol.toPrimitive];\n  if (void 0 !== e) {\n    var i = e.call(t, r);\n    if (\"object\" != typeof i) return i;\n    throw new TypeError(\"@@toPrimitive must return a primitive value.\");\n  }\n  return (\"string\" === r ? String : Number)(t);\n}\nfunction _toPropertyKey(t) {\n  var i = _toPrimitive(t, \"string\");\n  return \"symbol\" == typeof i ? i : i + \"\";\n}\nfunction _typeof(o) {\n  \"@babel/helpers - typeof\";\n\n  return _typeof = \"function\" == typeof Symbol && \"symbol\" == typeof Symbol.iterator ? function (o) {\n    return typeof o;\n  } : function (o) {\n    return o && \"function\" == typeof Symbol && o.constructor === Symbol && o !== Symbol.prototype ? \"symbol\" : typeof o;\n  }, _typeof(o);\n}\nfunction _unsupportedIterableToArray(r, a) {\n  if (r) {\n    if (\"string\" == typeof r) return _arrayLikeToArray(r, a);\n    var t = {}.toString.call(r).slice(8, -1);\n    return \"Object\" === t && r.constructor && (t = r.constructor.name), \"Map\" === t || \"Set\" === t ? Array.from(r) : \"Arguments\" === t || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t) ? _arrayLikeToArray(r, a) : void 0;\n  }\n}\n\nvar _materialDispose = function materialDispose(material) {\n  if (material instanceof Array) {\n    material.forEach(_materialDispose);\n  } else {\n    if (material.map) {\n      material.map.dispose();\n    }\n    material.dispose();\n  }\n};\nvar _deallocate = function deallocate(obj) {\n  if (obj.geometry) {\n    obj.geometry.dispose();\n  }\n  if (obj.material) {\n    _materialDispose(obj.material);\n  }\n  if (obj.texture) {\n    obj.texture.dispose();\n  }\n  if (obj.children) {\n    obj.children.forEach(_deallocate);\n  }\n};\nvar emptyObject = function emptyObject(obj) {\n  while (obj.children.length) {\n    var childObj = obj.children[0];\n    obj.remove(childObj);\n    _deallocate(childObj);\n  }\n};\n\nvar _dataBindAttr = /*#__PURE__*/new WeakMap();\nvar _objBindAttr = /*#__PURE__*/new WeakMap();\nvar ThreeDigest = /*#__PURE__*/function (_DataBindMapper) {\n  function ThreeDigest(scene) {\n    var _this;\n    var _ref = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {},\n      _ref$dataBindAttr = _ref.dataBindAttr,\n      dataBindAttr = _ref$dataBindAttr === void 0 ? '__data' : _ref$dataBindAttr,\n      _ref$objBindAttr = _ref.objBindAttr,\n      objBindAttr = _ref$objBindAttr === void 0 ? '__threeObj' : _ref$objBindAttr;\n    _classCallCheck(this, ThreeDigest);\n    _this = _callSuper(this, ThreeDigest);\n    _defineProperty(_this, \"scene\", void 0);\n    _classPrivateFieldInitSpec(_this, _dataBindAttr, void 0);\n    _classPrivateFieldInitSpec(_this, _objBindAttr, void 0);\n    _this.scene = scene;\n    _classPrivateFieldSet2(_dataBindAttr, _this, dataBindAttr);\n    _classPrivateFieldSet2(_objBindAttr, _this, objBindAttr);\n    _this.onRemoveObj(function () {});\n    return _this;\n  }\n  _inherits(ThreeDigest, _DataBindMapper);\n  return _createClass(ThreeDigest, [{\n    key: \"onCreateObj\",\n    value: function onCreateObj(fn) {\n      var _this2 = this;\n      _superPropGet(ThreeDigest, \"onCreateObj\", this)([function (d) {\n        var obj = fn(d);\n        d[_classPrivateFieldGet2(_objBindAttr, _this2)] = obj;\n        obj[_classPrivateFieldGet2(_dataBindAttr, _this2)] = d;\n        _this2.scene.add(obj);\n        return obj;\n      }]);\n      return this;\n    }\n  }, {\n    key: \"onRemoveObj\",\n    value: function onRemoveObj(fn) {\n      var _this3 = this;\n      _superPropGet(ThreeDigest, \"onRemoveObj\", this)([function (obj, dId) {\n        var d = _superPropGet(ThreeDigest, \"getData\", _this3)([obj]);\n        fn(obj, dId);\n        _this3.scene.remove(obj);\n        emptyObject(obj);\n        delete d[_classPrivateFieldGet2(_objBindAttr, _this3)];\n      }]);\n      return this;\n    }\n  }]);\n}(DataBindMapper);\n\nvar colorStr2Hex = function colorStr2Hex(str) {\n  return isNaN(str) ? parseInt(tinyColor(str).toHex(), 16) : str;\n};\nvar colorAlpha = function colorAlpha(str) {\n  return isNaN(str) ? tinyColor(str).getAlpha() : 1;\n};\nvar autoColorScale = scaleOrdinal(schemePaired);\n\n// Autoset attribute colorField by colorByAccessor property\n// If an object has already a color, don't set it\n// Objects can be nodes or links\nfunction autoColorObjects(objects, colorByAccessor, colorField) {\n  if (!colorByAccessor || typeof colorField !== 'string') return;\n  objects.filter(function (obj) {\n    return !obj[colorField];\n  }).forEach(function (obj) {\n    obj[colorField] = autoColorScale(colorByAccessor(obj));\n  });\n}\n\nfunction getDagDepths (_ref, idAccessor) {\n  var nodes = _ref.nodes,\n    links = _ref.links;\n  var _ref2 = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {},\n    _ref2$nodeFilter = _ref2.nodeFilter,\n    nodeFilter = _ref2$nodeFilter === void 0 ? function () {\n      return true;\n    } : _ref2$nodeFilter,\n    _ref2$onLoopError = _ref2.onLoopError,\n    onLoopError = _ref2$onLoopError === void 0 ? function (loopIds) {\n      throw \"Invalid DAG structure! Found cycle in node path: \".concat(loopIds.join(' -> '), \".\");\n    } : _ref2$onLoopError;\n  // linked graph\n  var graph = {};\n  nodes.forEach(function (node) {\n    return graph[idAccessor(node)] = {\n      data: node,\n      out: [],\n      depth: -1,\n      skip: !nodeFilter(node)\n    };\n  });\n  links.forEach(function (_ref3) {\n    var source = _ref3.source,\n      target = _ref3.target;\n    var sourceId = getNodeId(source);\n    var targetId = getNodeId(target);\n    if (!graph.hasOwnProperty(sourceId)) throw \"Missing source node with id: \".concat(sourceId);\n    if (!graph.hasOwnProperty(targetId)) throw \"Missing target node with id: \".concat(targetId);\n    var sourceNode = graph[sourceId];\n    var targetNode = graph[targetId];\n    sourceNode.out.push(targetNode);\n    function getNodeId(node) {\n      return _typeof(node) === 'object' ? idAccessor(node) : node;\n    }\n  });\n  var foundLoops = [];\n  traverse(Object.values(graph));\n  var nodeDepths = Object.assign.apply(Object, [{}].concat(_toConsumableArray(Object.entries(graph).filter(function (_ref4) {\n    var _ref5 = _slicedToArray(_ref4, 2),\n      node = _ref5[1];\n    return !node.skip;\n  }).map(function (_ref6) {\n    var _ref7 = _slicedToArray(_ref6, 2),\n      id = _ref7[0],\n      node = _ref7[1];\n    return _defineProperty({}, id, node.depth);\n  }))));\n  return nodeDepths;\n  function traverse(nodes) {\n    var nodeStack = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : [];\n    var currentDepth = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 0;\n    var _loop = function _loop() {\n      var node = nodes[i];\n      if (nodeStack.indexOf(node) !== -1) {\n        var loop = [].concat(_toConsumableArray(nodeStack.slice(nodeStack.indexOf(node))), [node]).map(function (d) {\n          return idAccessor(d.data);\n        });\n        if (!foundLoops.some(function (foundLoop) {\n          return foundLoop.length === loop.length && foundLoop.every(function (id, idx) {\n            return id === loop[idx];\n          });\n        })) {\n          foundLoops.push(loop);\n          onLoopError(loop);\n        }\n        return 1; // continue\n      }\n      if (currentDepth > node.depth) {\n        // Don't unnecessarily revisit chunks of the graph\n        node.depth = currentDepth;\n        traverse(node.out, [].concat(_toConsumableArray(nodeStack), [node]), currentDepth + (node.skip ? 0 : 1));\n      }\n    };\n    for (var i = 0, l = nodes.length; i < l; i++) {\n      if (_loop()) continue;\n    }\n  }\n}\n\nvar three$1 = window.THREE ? window.THREE // Prefer consumption from global THREE, if exists\n: {\n  Group: Group,\n  Mesh: Mesh,\n  MeshLambertMaterial: MeshLambertMaterial,\n  Color: Color,\n  BufferGeometry: BufferGeometry,\n  BufferAttribute: BufferAttribute,\n  Matrix4: Matrix4,\n  Vector3: Vector3,\n  SphereGeometry: SphereGeometry,\n  CylinderGeometry: CylinderGeometry,\n  TubeGeometry: TubeGeometry,\n  ConeGeometry: ConeGeometry,\n  Line: Line,\n  LineBasicMaterial: LineBasicMaterial,\n  QuadraticBezierCurve3: QuadraticBezierCurve3,\n  CubicBezierCurve3: CubicBezierCurve3,\n  Box3: Box3\n};\nvar ngraph = {\n  graph: graph,\n  forcelayout: forcelayout\n};\n\n//\n\nvar DAG_LEVEL_NODE_RATIO = 2;\n\n// support multiple method names for backwards threejs compatibility\nvar setAttributeFn = new three$1.BufferGeometry().setAttribute ? 'setAttribute' : 'addAttribute';\nvar applyMatrix4Fn = new three$1.BufferGeometry().applyMatrix4 ? 'applyMatrix4' : 'applyMatrix';\nvar ForceGraph = Kapsule({\n  props: {\n    jsonUrl: {\n      onChange: function onChange(jsonUrl, state) {\n        var _this = this;\n        if (jsonUrl && !state.fetchingJson) {\n          // Load data asynchronously\n          state.fetchingJson = true;\n          state.onLoading();\n          fetch(jsonUrl).then(function (r) {\n            return r.json();\n          }).then(function (json) {\n            state.fetchingJson = false;\n            state.onFinishLoading(json);\n            _this.graphData(json);\n          });\n        }\n      },\n      triggerUpdate: false\n    },\n    graphData: {\n      \"default\": {\n        nodes: [],\n        links: []\n      },\n      onChange: function onChange(graphData, state) {\n        state.engineRunning = false; // Pause simulation immediately\n      }\n    },\n    numDimensions: {\n      \"default\": 3,\n      onChange: function onChange(numDim, state) {\n        var chargeForce = state.d3ForceLayout.force('charge');\n        // Increase repulsion on 3D mode for improved spatial separation\n        if (chargeForce) {\n          chargeForce.strength(numDim > 2 ? -60 : -30);\n        }\n        if (numDim < 3) {\n          eraseDimension(state.graphData.nodes, 'z');\n        }\n        if (numDim < 2) {\n          eraseDimension(state.graphData.nodes, 'y');\n        }\n        function eraseDimension(nodes, dim) {\n          nodes.forEach(function (d) {\n            delete d[dim]; // position\n            delete d[\"v\".concat(dim)]; // velocity\n          });\n        }\n      }\n    },\n    dagMode: {\n      onChange: function onChange(dagMode, state) {\n        // td, bu, lr, rl, zin, zout, radialin, radialout\n        !dagMode && state.forceEngine === 'd3' && (state.graphData.nodes || []).forEach(function (n) {\n          return n.fx = n.fy = n.fz = undefined;\n        }); // unfix nodes when disabling dag mode\n      }\n    },\n    dagLevelDistance: {},\n    dagNodeFilter: {\n      \"default\": function _default(node) {\n        return true;\n      }\n    },\n    onDagError: {\n      triggerUpdate: false\n    },\n    nodeRelSize: {\n      \"default\": 4\n    },\n    // volume per val unit\n    nodeId: {\n      \"default\": 'id'\n    },\n    nodeVal: {\n      \"default\": 'val'\n    },\n    nodeResolution: {\n      \"default\": 8\n    },\n    // how many slice segments in the sphere's circumference\n    nodeColor: {\n      \"default\": 'color'\n    },\n    nodeAutoColorBy: {},\n    nodeOpacity: {\n      \"default\": 0.75\n    },\n    nodeVisibility: {\n      \"default\": true\n    },\n    nodeThreeObject: {},\n    nodeThreeObjectExtend: {\n      \"default\": false\n    },\n    nodePositionUpdate: {\n      triggerUpdate: false\n    },\n    // custom function to call for updating the node's position. Signature: (threeObj, { x, y, z}, node). If the function returns a truthy value, the regular node position update will not run.\n    linkSource: {\n      \"default\": 'source'\n    },\n    linkTarget: {\n      \"default\": 'target'\n    },\n    linkVisibility: {\n      \"default\": true\n    },\n    linkColor: {\n      \"default\": 'color'\n    },\n    linkAutoColorBy: {},\n    linkOpacity: {\n      \"default\": 0.2\n    },\n    linkWidth: {},\n    // Rounded to nearest decimal. For falsy values use dimensionless line with 1px regardless of distance.\n    linkResolution: {\n      \"default\": 6\n    },\n    // how many radial segments in each line tube's geometry\n    linkCurvature: {\n      \"default\": 0,\n      triggerUpdate: false\n    },\n    // line curvature radius (0: straight, 1: semi-circle)\n    linkCurveRotation: {\n      \"default\": 0,\n      triggerUpdate: false\n    },\n    // line curve rotation along the line axis (0: interection with XY plane, PI: upside down)\n    linkMaterial: {},\n    linkThreeObject: {},\n    linkThreeObjectExtend: {\n      \"default\": false\n    },\n    linkPositionUpdate: {\n      triggerUpdate: false\n    },\n    // custom function to call for updating the link's position. Signature: (threeObj, { start: { x, y, z},  end: { x, y, z }}, link). If the function returns a truthy value, the regular link position update will not run.\n    linkDirectionalArrowLength: {\n      \"default\": 0\n    },\n    linkDirectionalArrowColor: {},\n    linkDirectionalArrowRelPos: {\n      \"default\": 0.5,\n      triggerUpdate: false\n    },\n    // value between 0<>1 indicating the relative pos along the (exposed) line\n    linkDirectionalArrowResolution: {\n      \"default\": 8\n    },\n    // how many slice segments in the arrow's conic circumference\n    linkDirectionalParticles: {\n      \"default\": 0\n    },\n    // animate photons travelling in the link direction\n    linkDirectionalParticleSpeed: {\n      \"default\": 0.01,\n      triggerUpdate: false\n    },\n    // in link length ratio per frame\n    linkDirectionalParticleOffset: {\n      \"default\": 0,\n      triggerUpdate: false\n    },\n    // starting position offset along the link's length, like a pre-delay. Values between [0, 1]\n    linkDirectionalParticleWidth: {\n      \"default\": 0.5\n    },\n    linkDirectionalParticleColor: {},\n    linkDirectionalParticleResolution: {\n      \"default\": 4\n    },\n    // how many slice segments in the particle sphere's circumference\n    linkDirectionalParticleThreeObject: {},\n    forceEngine: {\n      \"default\": 'd3'\n    },\n    // d3 or ngraph\n    d3AlphaMin: {\n      \"default\": 0\n    },\n    d3AlphaDecay: {\n      \"default\": 0.0228,\n      triggerUpdate: false,\n      onChange: function onChange(alphaDecay, state) {\n        state.d3ForceLayout.alphaDecay(alphaDecay);\n      }\n    },\n    d3AlphaTarget: {\n      \"default\": 0,\n      triggerUpdate: false,\n      onChange: function onChange(alphaTarget, state) {\n        state.d3ForceLayout.alphaTarget(alphaTarget);\n      }\n    },\n    d3VelocityDecay: {\n      \"default\": 0.4,\n      triggerUpdate: false,\n      onChange: function onChange(velocityDecay, state) {\n        state.d3ForceLayout.velocityDecay(velocityDecay);\n      }\n    },\n    ngraphPhysics: {\n      \"default\": {\n        // defaults from https://github.com/anvaka/ngraph.physics.simulator/blob/master/index.js\n        timeStep: 20,\n        gravity: -1.2,\n        theta: 0.8,\n        springLength: 30,\n        springCoefficient: 0.0008,\n        dragCoefficient: 0.02\n      }\n    },\n    warmupTicks: {\n      \"default\": 0,\n      triggerUpdate: false\n    },\n    // how many times to tick the force engine at init before starting to render\n    cooldownTicks: {\n      \"default\": Infinity,\n      triggerUpdate: false\n    },\n    cooldownTime: {\n      \"default\": 15000,\n      triggerUpdate: false\n    },\n    // ms\n    onLoading: {\n      \"default\": function _default() {},\n      triggerUpdate: false\n    },\n    onFinishLoading: {\n      \"default\": function _default() {},\n      triggerUpdate: false\n    },\n    onUpdate: {\n      \"default\": function _default() {},\n      triggerUpdate: false\n    },\n    onFinishUpdate: {\n      \"default\": function _default() {},\n      triggerUpdate: false\n    },\n    onEngineTick: {\n      \"default\": function _default() {},\n      triggerUpdate: false\n    },\n    onEngineStop: {\n      \"default\": function _default() {},\n      triggerUpdate: false\n    }\n  },\n  methods: {\n    refresh: function refresh(state) {\n      state._flushObjects = true;\n      state._rerender();\n      return this;\n    },\n    // Expose d3 forces for external manipulation\n    d3Force: function d3Force(state, forceName, forceFn) {\n      if (forceFn === undefined) {\n        return state.d3ForceLayout.force(forceName); // Force getter\n      }\n      state.d3ForceLayout.force(forceName, forceFn); // Force setter\n      return this;\n    },\n    d3ReheatSimulation: function d3ReheatSimulation(state) {\n      state.d3ForceLayout.alpha(1);\n      this.resetCountdown();\n      return this;\n    },\n    // reset cooldown state\n    resetCountdown: function resetCountdown(state) {\n      state.cntTicks = 0;\n      state.startTickTime = new Date();\n      state.engineRunning = true;\n      return this;\n    },\n    tickFrame: function tickFrame(state) {\n      var isD3Sim = state.forceEngine !== 'ngraph';\n      if (state.engineRunning) {\n        layoutTick();\n      }\n      updateArrows();\n      updatePhotons();\n      return this;\n\n      //\n\n      function layoutTick() {\n        if (++state.cntTicks > state.cooldownTicks || new Date() - state.startTickTime > state.cooldownTime || isD3Sim && state.d3AlphaMin > 0 && state.d3ForceLayout.alpha() < state.d3AlphaMin) {\n          state.engineRunning = false; // Stop ticking graph\n          state.onEngineStop();\n        } else {\n          state.layout[isD3Sim ? 'tick' : 'step'](); // Tick it\n          state.onEngineTick();\n        }\n        var nodeThreeObjectExtendAccessor = accessorFn(state.nodeThreeObjectExtend);\n\n        // Update nodes position\n        state.nodeDataMapper.entries().forEach(function (_ref) {\n          var _ref2 = _slicedToArray(_ref, 2),\n            node = _ref2[0],\n            obj = _ref2[1];\n          if (!obj) return;\n          var pos = isD3Sim ? node : state.layout.getNodePosition(node[state.nodeId]);\n          var extendedObj = nodeThreeObjectExtendAccessor(node);\n          if (!state.nodePositionUpdate || !state.nodePositionUpdate(extendedObj ? obj.children[0] : obj, {\n            x: pos.x,\n            y: pos.y,\n            z: pos.z\n          }, node) // pass child custom object if extending the default\n          || extendedObj) {\n            obj.position.x = pos.x;\n            obj.position.y = pos.y || 0;\n            obj.position.z = pos.z || 0;\n          }\n        });\n\n        // Update links position\n        var linkWidthAccessor = accessorFn(state.linkWidth);\n        var linkCurvatureAccessor = accessorFn(state.linkCurvature);\n        var linkCurveRotationAccessor = accessorFn(state.linkCurveRotation);\n        var linkThreeObjectExtendAccessor = accessorFn(state.linkThreeObjectExtend);\n        state.linkDataMapper.entries().forEach(function (_ref3) {\n          var _ref4 = _slicedToArray(_ref3, 2),\n            link = _ref4[0],\n            lineObj = _ref4[1];\n          if (!lineObj) return;\n          var pos = isD3Sim ? link : state.layout.getLinkPosition(state.layout.graph.getLink(link.source, link.target).id);\n          var start = pos[isD3Sim ? 'source' : 'from'];\n          var end = pos[isD3Sim ? 'target' : 'to'];\n          if (!start || !end || !start.hasOwnProperty('x') || !end.hasOwnProperty('x')) return; // skip invalid link\n\n          calcLinkCurve(link); // calculate link curve for all links, including custom replaced, so it can be used in directional functionality\n\n          var extendedObj = linkThreeObjectExtendAccessor(link);\n          if (state.linkPositionUpdate && state.linkPositionUpdate(extendedObj ? lineObj.children[1] : lineObj,\n          // pass child custom object if extending the default\n          {\n            start: {\n              x: start.x,\n              y: start.y,\n              z: start.z\n            },\n            end: {\n              x: end.x,\n              y: end.y,\n              z: end.z\n            }\n          }, link) && !extendedObj) {\n            // exit if successfully custom updated position of non-extended obj\n            return;\n          }\n          var curveResolution = 30; // # line segments\n          var curve = link.__curve;\n\n          // select default line obj if it's an extended group\n          var line = lineObj.children.length ? lineObj.children[0] : lineObj;\n          if (line.type === 'Line') {\n            // Update line geometry\n            if (!curve) {\n              // straight line\n              var linePos = line.geometry.getAttribute('position');\n              if (!linePos || !linePos.array || linePos.array.length !== 6) {\n                line.geometry[setAttributeFn]('position', linePos = new three$1.BufferAttribute(new Float32Array(2 * 3), 3));\n              }\n              linePos.array[0] = start.x;\n              linePos.array[1] = start.y || 0;\n              linePos.array[2] = start.z || 0;\n              linePos.array[3] = end.x;\n              linePos.array[4] = end.y || 0;\n              linePos.array[5] = end.z || 0;\n              linePos.needsUpdate = true;\n            } else {\n              // bezier curve line\n              var curvePnts = curve.getPoints(curveResolution);\n              // resize buffer if needed\n              if (line.geometry.getAttribute('position').array.length !== curvePnts.length * 3) {\n                line.geometry[setAttributeFn]('position', new three$1.BufferAttribute(new Float32Array(curvePnts.length * 3), 3));\n              }\n              line.geometry.setFromPoints(curvePnts);\n            }\n            line.geometry.computeBoundingSphere();\n          } else if (line.type === 'Mesh') {\n            // Update cylinder geometry\n\n            if (!curve) {\n              // straight tube\n              if (!line.geometry.type.match(/^Cylinder(Buffer)?Geometry$/)) {\n                var linkWidth = Math.ceil(linkWidthAccessor(link) * 10) / 10;\n                var r = linkWidth / 2;\n                var geometry = new three$1.CylinderGeometry(r, r, 1, state.linkResolution, 1, false);\n                geometry[applyMatrix4Fn](new three$1.Matrix4().makeTranslation(0, 1 / 2, 0));\n                geometry[applyMatrix4Fn](new three$1.Matrix4().makeRotationX(Math.PI / 2));\n                line.geometry.dispose();\n                line.geometry = geometry;\n              }\n              var vStart = new three$1.Vector3(start.x, start.y || 0, start.z || 0);\n              var vEnd = new three$1.Vector3(end.x, end.y || 0, end.z || 0);\n              var distance = vStart.distanceTo(vEnd);\n              line.position.x = vStart.x;\n              line.position.y = vStart.y;\n              line.position.z = vStart.z;\n              line.scale.z = distance;\n              line.parent.localToWorld(vEnd); // lookAt requires world coords\n              line.lookAt(vEnd);\n            } else {\n              // curved tube\n              if (!line.geometry.type.match(/^Tube(Buffer)?Geometry$/)) {\n                // reset object positioning\n                line.position.set(0, 0, 0);\n                line.rotation.set(0, 0, 0);\n                line.scale.set(1, 1, 1);\n              }\n              var _linkWidth = Math.ceil(linkWidthAccessor(link) * 10) / 10;\n              var _r = _linkWidth / 2;\n              var _geometry = new three$1.TubeGeometry(curve, curveResolution, _r, state.linkResolution, false);\n              line.geometry.dispose();\n              line.geometry = _geometry;\n            }\n          }\n        });\n\n        //\n\n        function calcLinkCurve(link) {\n          var pos = isD3Sim ? link : state.layout.getLinkPosition(state.layout.graph.getLink(link.source, link.target).id);\n          var start = pos[isD3Sim ? 'source' : 'from'];\n          var end = pos[isD3Sim ? 'target' : 'to'];\n          if (!start || !end || !start.hasOwnProperty('x') || !end.hasOwnProperty('x')) return; // skip invalid link\n\n          var curvature = linkCurvatureAccessor(link);\n          if (!curvature) {\n            link.__curve = null; // Straight line\n          } else {\n            // bezier curve line (only for line types)\n            var vStart = new three$1.Vector3(start.x, start.y || 0, start.z || 0);\n            var vEnd = new three$1.Vector3(end.x, end.y || 0, end.z || 0);\n            var l = vStart.distanceTo(vEnd); // line length\n\n            var curve;\n            var curveRotation = linkCurveRotationAccessor(link);\n            if (l > 0) {\n              var dx = end.x - start.x;\n              var dy = end.y - start.y || 0;\n              var vLine = new three$1.Vector3().subVectors(vEnd, vStart);\n              var cp = vLine.clone().multiplyScalar(curvature).cross(dx !== 0 || dy !== 0 ? new three$1.Vector3(0, 0, 1) : new three$1.Vector3(0, 1, 0)) // avoid cross-product of parallel vectors (prefer Z, fallback to Y)\n              .applyAxisAngle(vLine.normalize(), curveRotation) // rotate along line axis according to linkCurveRotation\n              .add(new three$1.Vector3().addVectors(vStart, vEnd).divideScalar(2));\n              curve = new three$1.QuadraticBezierCurve3(vStart, cp, vEnd);\n            } else {\n              // Same point, draw a loop\n              var d = curvature * 70;\n              var endAngle = -curveRotation; // Rotate clockwise (from Z angle perspective)\n              var startAngle = endAngle + Math.PI / 2;\n              curve = new three$1.CubicBezierCurve3(vStart, new three$1.Vector3(d * Math.cos(startAngle), d * Math.sin(startAngle), 0).add(vStart), new three$1.Vector3(d * Math.cos(endAngle), d * Math.sin(endAngle), 0).add(vStart), vEnd);\n            }\n            link.__curve = curve;\n          }\n        }\n      }\n      function updateArrows() {\n        // update link arrow position\n        var arrowRelPosAccessor = accessorFn(state.linkDirectionalArrowRelPos);\n        var arrowLengthAccessor = accessorFn(state.linkDirectionalArrowLength);\n        var nodeValAccessor = accessorFn(state.nodeVal);\n        state.arrowDataMapper.entries().forEach(function (_ref5) {\n          var _ref6 = _slicedToArray(_ref5, 2),\n            link = _ref6[0],\n            arrowObj = _ref6[1];\n          if (!arrowObj) return;\n          var pos = isD3Sim ? link : state.layout.getLinkPosition(state.layout.graph.getLink(link.source, link.target).id);\n          var start = pos[isD3Sim ? 'source' : 'from'];\n          var end = pos[isD3Sim ? 'target' : 'to'];\n          if (!start || !end || !start.hasOwnProperty('x') || !end.hasOwnProperty('x')) return; // skip invalid link\n\n          var startR = Math.cbrt(Math.max(0, nodeValAccessor(start) || 1)) * state.nodeRelSize;\n          var endR = Math.cbrt(Math.max(0, nodeValAccessor(end) || 1)) * state.nodeRelSize;\n          var arrowLength = arrowLengthAccessor(link);\n          var arrowRelPos = arrowRelPosAccessor(link);\n          var getPosAlongLine = link.__curve ? function (t) {\n            return link.__curve.getPoint(t);\n          } // interpolate along bezier curve\n          : function (t) {\n            // straight line: interpolate linearly\n            var iplt = function iplt(dim, start, end, t) {\n              return start[dim] + (end[dim] - start[dim]) * t || 0;\n            };\n            return {\n              x: iplt('x', start, end, t),\n              y: iplt('y', start, end, t),\n              z: iplt('z', start, end, t)\n            };\n          };\n          var lineLen = link.__curve ? link.__curve.getLength() : Math.sqrt(['x', 'y', 'z'].map(function (dim) {\n            return Math.pow((end[dim] || 0) - (start[dim] || 0), 2);\n          }).reduce(function (acc, v) {\n            return acc + v;\n          }, 0));\n          var posAlongLine = startR + arrowLength + (lineLen - startR - endR - arrowLength) * arrowRelPos;\n          var arrowHead = getPosAlongLine(posAlongLine / lineLen);\n          var arrowTail = getPosAlongLine((posAlongLine - arrowLength) / lineLen);\n          ['x', 'y', 'z'].forEach(function (dim) {\n            return arrowObj.position[dim] = arrowTail[dim];\n          });\n          var headVec = _construct(three$1.Vector3, _toConsumableArray(['x', 'y', 'z'].map(function (c) {\n            return arrowHead[c];\n          })));\n          arrowObj.parent.localToWorld(headVec); // lookAt requires world coords\n          arrowObj.lookAt(headVec);\n        });\n      }\n      function updatePhotons() {\n        // update link particle positions\n        var particleSpeedAccessor = accessorFn(state.linkDirectionalParticleSpeed);\n        var particleOffsetAccessor = accessorFn(state.linkDirectionalParticleOffset);\n        state.graphData.links.forEach(function (link) {\n          var photonsObj = state.particlesDataMapper.getObj(link);\n          var cyclePhotons = photonsObj && photonsObj.children;\n          var singleHopPhotons = link.__singleHopPhotonsObj && link.__singleHopPhotonsObj.children;\n          if ((!singleHopPhotons || !singleHopPhotons.length) && (!cyclePhotons || !cyclePhotons.length)) return;\n          var pos = isD3Sim ? link : state.layout.getLinkPosition(state.layout.graph.getLink(link.source, link.target).id);\n          var start = pos[isD3Sim ? 'source' : 'from'];\n          var end = pos[isD3Sim ? 'target' : 'to'];\n          if (!start || !end || !start.hasOwnProperty('x') || !end.hasOwnProperty('x')) return; // skip invalid link\n\n          var particleSpeed = particleSpeedAccessor(link);\n          var particleOffset = Math.abs(particleOffsetAccessor(link));\n          var getPhotonPos = link.__curve ? function (t) {\n            return link.__curve.getPoint(t);\n          } // interpolate along bezier curve\n          : function (t) {\n            // straight line: interpolate linearly\n            var iplt = function iplt(dim, start, end, t) {\n              return start[dim] + (end[dim] - start[dim]) * t || 0;\n            };\n            return {\n              x: iplt('x', start, end, t),\n              y: iplt('y', start, end, t),\n              z: iplt('z', start, end, t)\n            };\n          };\n          var photons = [].concat(_toConsumableArray(cyclePhotons || []), _toConsumableArray(singleHopPhotons || []));\n          photons.forEach(function (photon, idx) {\n            var singleHop = photon.parent.__linkThreeObjType === 'singleHopPhotons';\n            if (!photon.hasOwnProperty('__progressRatio')) {\n              photon.__progressRatio = singleHop ? 0 : (idx + particleOffset) / cyclePhotons.length;\n            }\n            photon.__progressRatio += particleSpeed;\n            if (photon.__progressRatio >= 1) {\n              if (!singleHop) {\n                photon.__progressRatio = photon.__progressRatio % 1;\n              } else {\n                // remove particle\n                photon.parent.remove(photon);\n                emptyObject(photon);\n                return;\n              }\n            }\n            var photonPosRatio = photon.__progressRatio;\n            var pos = getPhotonPos(photonPosRatio);\n\n            // Orient asymmetrical particles to target\n            photon.geometry.type !== 'SphereGeometry' && photon.lookAt(pos.x, pos.y, pos.z);\n            ['x', 'y', 'z'].forEach(function (dim) {\n              return photon.position[dim] = pos[dim];\n            });\n          });\n        });\n      }\n    },\n    emitParticle: function emitParticle(state, link) {\n      if (link && state.graphData.links.includes(link)) {\n        if (!link.__singleHopPhotonsObj) {\n          var obj = new three$1.Group();\n          obj.__linkThreeObjType = 'singleHopPhotons';\n          link.__singleHopPhotonsObj = obj;\n          state.graphScene.add(obj);\n        }\n        var particleObj = accessorFn(state.linkDirectionalParticleThreeObject)(link);\n        if (particleObj && state.linkDirectionalParticleThreeObject === particleObj) {\n          // clone object if it's a shared object among all links\n          particleObj = particleObj.clone();\n        }\n        if (!particleObj) {\n          var particleWidthAccessor = accessorFn(state.linkDirectionalParticleWidth);\n          var photonR = Math.ceil(particleWidthAccessor(link) * 10) / 10 / 2;\n          var numSegments = state.linkDirectionalParticleResolution;\n          var particleGeometry = new three$1.SphereGeometry(photonR, numSegments, numSegments);\n          var linkColorAccessor = accessorFn(state.linkColor);\n          var particleColorAccessor = accessorFn(state.linkDirectionalParticleColor);\n          var photonColor = particleColorAccessor(link) || linkColorAccessor(link) || '#f0f0f0';\n          var materialColor = new three$1.Color(colorStr2Hex(photonColor));\n          var opacity = state.linkOpacity * 3;\n          var particleMaterial = new three$1.MeshLambertMaterial({\n            color: materialColor,\n            transparent: true,\n            opacity: opacity\n          });\n          particleObj = new three$1.Mesh(particleGeometry, particleMaterial);\n        }\n\n        // add a single hop particle\n        link.__singleHopPhotonsObj.add(particleObj);\n      }\n      return this;\n    },\n    getGraphBbox: function getGraphBbox(state) {\n      var nodeFilter = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : function () {\n        return true;\n      };\n      if (!state.initialised) return null;\n\n      // recursively collect all nested geometries bboxes\n      var bboxes = function getBboxes(obj) {\n        var bboxes = [];\n        if (obj.geometry) {\n          obj.geometry.computeBoundingBox();\n          var box = new three$1.Box3();\n          box.copy(obj.geometry.boundingBox).applyMatrix4(obj.matrixWorld);\n          bboxes.push(box);\n        }\n        return bboxes.concat.apply(bboxes, _toConsumableArray((obj.children || []).filter(function (obj) {\n          return !obj.hasOwnProperty('__graphObjType') || obj.__graphObjType === 'node' && nodeFilter(obj.__data);\n        } // exclude filtered out nodes\n        ).map(getBboxes)));\n      }(state.graphScene);\n      if (!bboxes.length) return null;\n\n      // extract global x,y,z min/max\n      return Object.assign.apply(Object, _toConsumableArray(['x', 'y', 'z'].map(function (c) {\n        return _defineProperty({}, c, [min(bboxes, function (bb) {\n          return bb.min[c];\n        }), max(bboxes, function (bb) {\n          return bb.max[c];\n        })]);\n      })));\n    }\n  },\n  stateInit: function stateInit() {\n    return {\n      d3ForceLayout: forceSimulation().force('link', forceLink()).force('charge', forceManyBody()).force('center', forceCenter()).force('dagRadial', null).stop(),\n      engineRunning: false\n    };\n  },\n  init: function init(threeObj, state) {\n    // Main three object to manipulate\n    state.graphScene = threeObj;\n    state.nodeDataMapper = new ThreeDigest(threeObj, {\n      objBindAttr: '__threeObj'\n    });\n    state.linkDataMapper = new ThreeDigest(threeObj, {\n      objBindAttr: '__lineObj'\n    });\n    state.arrowDataMapper = new ThreeDigest(threeObj, {\n      objBindAttr: '__arrowObj'\n    });\n    state.particlesDataMapper = new ThreeDigest(threeObj, {\n      objBindAttr: '__photonsObj'\n    });\n  },\n  update: function update(state, changedProps) {\n    var hasAnyPropChanged = function hasAnyPropChanged(propList) {\n      return propList.some(function (p) {\n        return changedProps.hasOwnProperty(p);\n      });\n    };\n    state.engineRunning = false; // pause simulation\n    typeof state.onUpdate === \"function\" && state.onUpdate();\n    if (state.nodeAutoColorBy !== null && hasAnyPropChanged(['nodeAutoColorBy', 'graphData', 'nodeColor'])) {\n      // Auto add color to uncolored nodes\n      autoColorObjects(state.graphData.nodes, accessorFn(state.nodeAutoColorBy), state.nodeColor);\n    }\n    if (state.linkAutoColorBy !== null && hasAnyPropChanged(['linkAutoColorBy', 'graphData', 'linkColor'])) {\n      // Auto add color to uncolored links\n      autoColorObjects(state.graphData.links, accessorFn(state.linkAutoColorBy), state.linkColor);\n    }\n\n    // Digest nodes WebGL objects\n    if (state._flushObjects || hasAnyPropChanged(['graphData', 'nodeThreeObject', 'nodeThreeObjectExtend', 'nodeVal', 'nodeColor', 'nodeVisibility', 'nodeRelSize', 'nodeResolution', 'nodeOpacity'])) {\n      var customObjectAccessor = accessorFn(state.nodeThreeObject);\n      var customObjectExtendAccessor = accessorFn(state.nodeThreeObjectExtend);\n      var valAccessor = accessorFn(state.nodeVal);\n      var colorAccessor = accessorFn(state.nodeColor);\n      var visibilityAccessor = accessorFn(state.nodeVisibility);\n      var sphereGeometries = {}; // indexed by node value\n      var sphereMaterials = {}; // indexed by color\n\n      if (state._flushObjects || hasAnyPropChanged([\n      // recreate objects if any of these props have changed\n      'nodeThreeObject', 'nodeThreeObjectExtend'])) state.nodeDataMapper.clear();\n      state.nodeDataMapper.onCreateObj(function (node) {\n        var customObj = customObjectAccessor(node);\n        var extendObj = customObjectExtendAccessor(node);\n        if (customObj && state.nodeThreeObject === customObj) {\n          // clone object if it's a shared object among all nodes\n          customObj = customObj.clone();\n        }\n        var obj;\n        if (customObj && !extendObj) {\n          obj = customObj;\n        } else {\n          // Add default object (sphere mesh)\n          obj = new three$1.Mesh();\n          obj.__graphDefaultObj = true;\n          if (customObj && extendObj) {\n            obj.add(customObj); // extend default with custom\n          }\n        }\n        obj.__graphObjType = 'node'; // Add object type\n\n        return obj;\n      }).onUpdateObj(function (obj, node) {\n        if (obj.__graphDefaultObj) {\n          // bypass internal updates for custom node objects\n          var val = valAccessor(node) || 1;\n          var radius = Math.cbrt(val) * state.nodeRelSize;\n          var numSegments = state.nodeResolution;\n          if (!obj.geometry.type.match(/^Sphere(Buffer)?Geometry$/) || obj.geometry.parameters.radius !== radius || obj.geometry.parameters.widthSegments !== numSegments) {\n            if (!sphereGeometries.hasOwnProperty(val)) {\n              sphereGeometries[val] = new three$1.SphereGeometry(radius, numSegments, numSegments);\n            }\n            obj.geometry.dispose();\n            obj.geometry = sphereGeometries[val];\n          }\n          var color = colorAccessor(node);\n          var materialColor = new three$1.Color(colorStr2Hex(color || '#ffffaa'));\n          var opacity = state.nodeOpacity * colorAlpha(color);\n          if (obj.material.type !== 'MeshLambertMaterial' || !obj.material.color.equals(materialColor) || obj.material.opacity !== opacity) {\n            if (!sphereMaterials.hasOwnProperty(color)) {\n              sphereMaterials[color] = new three$1.MeshLambertMaterial({\n                color: materialColor,\n                transparent: true,\n                opacity: opacity\n              });\n            }\n            obj.material.dispose();\n            obj.material = sphereMaterials[color];\n          }\n        }\n      }).digest(state.graphData.nodes.filter(visibilityAccessor));\n    }\n\n    // Digest links WebGL objects\n    if (state._flushObjects || hasAnyPropChanged(['graphData', 'linkThreeObject', 'linkThreeObjectExtend', 'linkMaterial', 'linkColor', 'linkWidth', 'linkVisibility', 'linkResolution', 'linkOpacity', 'linkDirectionalArrowLength', 'linkDirectionalArrowColor', 'linkDirectionalArrowResolution', 'linkDirectionalParticles', 'linkDirectionalParticleWidth', 'linkDirectionalParticleColor', 'linkDirectionalParticleResolution', 'linkDirectionalParticleThreeObject'])) {\n      var _customObjectAccessor = accessorFn(state.linkThreeObject);\n      var _customObjectExtendAccessor = accessorFn(state.linkThreeObjectExtend);\n      var customMaterialAccessor = accessorFn(state.linkMaterial);\n      var _visibilityAccessor = accessorFn(state.linkVisibility);\n      var _colorAccessor = accessorFn(state.linkColor);\n      var widthAccessor = accessorFn(state.linkWidth);\n      var cylinderGeometries = {}; // indexed by link width\n      var lambertLineMaterials = {}; // for cylinder objects, indexed by link color\n      var basicLineMaterials = {}; // for line objects, indexed by link color\n\n      var visibleLinks = state.graphData.links.filter(_visibilityAccessor);\n\n      // lines digest cycle\n      if (state._flushObjects || hasAnyPropChanged([\n      // recreate objects if any of these props have changed\n      'linkThreeObject', 'linkThreeObjectExtend', 'linkWidth'])) state.linkDataMapper.clear();\n      state.linkDataMapper.onRemoveObj(function (obj) {\n        // remove trailing single photons\n        var singlePhotonsObj = obj.__data && obj.__data.__singleHopPhotonsObj;\n        if (singlePhotonsObj) {\n          singlePhotonsObj.parent.remove(singlePhotonsObj);\n          emptyObject(singlePhotonsObj);\n          delete obj.__data.__singleHopPhotonsObj;\n        }\n      }).onCreateObj(function (link) {\n        var customObj = _customObjectAccessor(link);\n        var extendObj = _customObjectExtendAccessor(link);\n        if (customObj && state.linkThreeObject === customObj) {\n          // clone object if it's a shared object among all links\n          customObj = customObj.clone();\n        }\n        var defaultObj;\n        if (!customObj || extendObj) {\n          // construct default line obj\n          var useCylinder = !!widthAccessor(link);\n          if (useCylinder) {\n            defaultObj = new three$1.Mesh();\n          } else {\n            // Use plain line (constant width)\n            var lineGeometry = new three$1.BufferGeometry();\n            lineGeometry[setAttributeFn]('position', new three$1.BufferAttribute(new Float32Array(2 * 3), 3));\n            defaultObj = new three$1.Line(lineGeometry);\n          }\n        }\n        var obj;\n        if (!customObj) {\n          obj = defaultObj;\n          obj.__graphDefaultObj = true;\n        } else {\n          if (!extendObj) {\n            // use custom object\n            obj = customObj;\n          } else {\n            // extend default with custom in a group\n            obj = new three$1.Group();\n            obj.__graphDefaultObj = true;\n            obj.add(defaultObj);\n            obj.add(customObj);\n          }\n        }\n        obj.renderOrder = 10; // Prevent visual glitches of dark lines on top of nodes by rendering them last\n\n        obj.__graphObjType = 'link'; // Add object type\n\n        return obj;\n      }).onUpdateObj(function (updObj, link) {\n        if (updObj.__graphDefaultObj) {\n          // bypass internal updates for custom link objects\n          // select default object if it's an extended group\n          var obj = updObj.children.length ? updObj.children[0] : updObj;\n          var linkWidth = Math.ceil(widthAccessor(link) * 10) / 10;\n          var useCylinder = !!linkWidth;\n          if (useCylinder) {\n            var r = linkWidth / 2;\n            var numSegments = state.linkResolution;\n            if (!obj.geometry.type.match(/^Cylinder(Buffer)?Geometry$/) || obj.geometry.parameters.radiusTop !== r || obj.geometry.parameters.radialSegments !== numSegments) {\n              if (!cylinderGeometries.hasOwnProperty(linkWidth)) {\n                var geometry = new three$1.CylinderGeometry(r, r, 1, numSegments, 1, false);\n                geometry[applyMatrix4Fn](new three$1.Matrix4().makeTranslation(0, 1 / 2, 0));\n                geometry[applyMatrix4Fn](new three$1.Matrix4().makeRotationX(Math.PI / 2));\n                cylinderGeometries[linkWidth] = geometry;\n              }\n              obj.geometry.dispose();\n              obj.geometry = cylinderGeometries[linkWidth];\n            }\n          }\n          var customMaterial = customMaterialAccessor(link);\n          if (customMaterial) {\n            obj.material = customMaterial;\n          } else {\n            var color = _colorAccessor(link);\n            var materialColor = new three$1.Color(colorStr2Hex(color || '#f0f0f0'));\n            var opacity = state.linkOpacity * colorAlpha(color);\n            var materialType = useCylinder ? 'MeshLambertMaterial' : 'LineBasicMaterial';\n            if (obj.material.type !== materialType || !obj.material.color.equals(materialColor) || obj.material.opacity !== opacity) {\n              var lineMaterials = useCylinder ? lambertLineMaterials : basicLineMaterials;\n              if (!lineMaterials.hasOwnProperty(color)) {\n                lineMaterials[color] = new three$1[materialType]({\n                  color: materialColor,\n                  transparent: opacity < 1,\n                  opacity: opacity,\n                  depthWrite: opacity >= 1 // Prevent transparency issues\n                });\n              }\n              obj.material.dispose();\n              obj.material = lineMaterials[color];\n            }\n          }\n        }\n      }).digest(visibleLinks);\n\n      // Arrows digest cycle\n      if (state.linkDirectionalArrowLength || changedProps.hasOwnProperty('linkDirectionalArrowLength')) {\n        var arrowLengthAccessor = accessorFn(state.linkDirectionalArrowLength);\n        var arrowColorAccessor = accessorFn(state.linkDirectionalArrowColor);\n        state.arrowDataMapper.onCreateObj(function () {\n          var obj = new three$1.Mesh(undefined, new three$1.MeshLambertMaterial({\n            transparent: true\n          }));\n          obj.__linkThreeObjType = 'arrow'; // Add object type\n\n          return obj;\n        }).onUpdateObj(function (obj, link) {\n          var arrowLength = arrowLengthAccessor(link);\n          var numSegments = state.linkDirectionalArrowResolution;\n          if (!obj.geometry.type.match(/^Cone(Buffer)?Geometry$/) || obj.geometry.parameters.height !== arrowLength || obj.geometry.parameters.radialSegments !== numSegments) {\n            var coneGeometry = new three$1.ConeGeometry(arrowLength * 0.25, arrowLength, numSegments);\n            // Correct orientation\n            coneGeometry.translate(0, arrowLength / 2, 0);\n            coneGeometry.rotateX(Math.PI / 2);\n            obj.geometry.dispose();\n            obj.geometry = coneGeometry;\n          }\n          var arrowColor = arrowColorAccessor(link) || _colorAccessor(link) || '#f0f0f0';\n          obj.material.color = new three$1.Color(colorStr2Hex(arrowColor));\n          obj.material.opacity = state.linkOpacity * 3 * colorAlpha(arrowColor);\n        }).digest(visibleLinks.filter(arrowLengthAccessor));\n      }\n\n      // Photon particles digest cycle\n      if (state.linkDirectionalParticles || changedProps.hasOwnProperty('linkDirectionalParticles')) {\n        var particlesAccessor = accessorFn(state.linkDirectionalParticles);\n        var particleWidthAccessor = accessorFn(state.linkDirectionalParticleWidth);\n        var particleColorAccessor = accessorFn(state.linkDirectionalParticleColor);\n        var particleObjectAccessor = accessorFn(state.linkDirectionalParticleThreeObject);\n        var particleMaterials = {}; // indexed by link color\n        var particleGeometries = {}; // indexed by particle width\n\n        state.particlesDataMapper.onCreateObj(function () {\n          var obj = new three$1.Group();\n          obj.__linkThreeObjType = 'photons'; // Add object type\n\n          obj.__photonDataMapper = new ThreeDigest(obj);\n          return obj;\n        }).onUpdateObj(function (obj, link) {\n          var curPhoton = !!obj.children.length && obj.children[0];\n          var customObj = particleObjectAccessor(link);\n          var particleGeometry, particleMaterial;\n          if (customObj) {\n            particleGeometry = customObj.geometry;\n            particleMaterial = customObj.material;\n          } else {\n            var photonR = Math.ceil(particleWidthAccessor(link) * 10) / 10 / 2;\n            var numSegments = state.linkDirectionalParticleResolution;\n            if (curPhoton && curPhoton.geometry.parameters.radius === photonR && curPhoton.geometry.parameters.widthSegments === numSegments) {\n              particleGeometry = curPhoton.geometry;\n            } else {\n              if (!particleGeometries.hasOwnProperty(photonR)) {\n                particleGeometries[photonR] = new three$1.SphereGeometry(photonR, numSegments, numSegments);\n              }\n              particleGeometry = particleGeometries[photonR];\n            }\n            var photonColor = particleColorAccessor(link) || _colorAccessor(link) || '#f0f0f0';\n            var materialColor = new three$1.Color(colorStr2Hex(photonColor));\n            var opacity = state.linkOpacity * 3;\n            if (curPhoton && curPhoton.material.color.equals(materialColor) && curPhoton.material.opacity === opacity) {\n              particleMaterial = curPhoton.material;\n            } else {\n              if (!particleMaterials.hasOwnProperty(photonColor)) {\n                particleMaterials[photonColor] = new three$1.MeshLambertMaterial({\n                  color: materialColor,\n                  transparent: true,\n                  opacity: opacity\n                });\n              }\n              particleMaterial = particleMaterials[photonColor];\n            }\n          }\n          if (curPhoton) {\n            // Dispose of previous particles\n            curPhoton.geometry !== particleGeometry && curPhoton.geometry.dispose();\n            curPhoton.material !== particleMaterial && curPhoton.material.dispose();\n          }\n\n          // digest cycle for each photon\n          var numPhotons = Math.round(Math.abs(particlesAccessor(link)));\n          obj.__photonDataMapper.id(function (d) {\n            return d.idx;\n          }).onCreateObj(function () {\n            return new three$1.Mesh(particleGeometry, particleMaterial);\n          }).onUpdateObj(function (obj) {\n            obj.geometry = particleGeometry;\n            obj.material = particleMaterial;\n          }).digest(_toConsumableArray(new Array(numPhotons)).map(function (_, idx) {\n            return {\n              idx: idx\n            };\n          }));\n        }).digest(visibleLinks.filter(particlesAccessor));\n      }\n    }\n    state._flushObjects = false; // reset objects refresh flag\n\n    // simulation engine\n    if (hasAnyPropChanged(['graphData', 'nodeId', 'linkSource', 'linkTarget', 'numDimensions', 'forceEngine', 'dagMode', 'dagNodeFilter', 'dagLevelDistance'])) {\n      state.engineRunning = false; // Pause simulation\n\n      // parse links\n      state.graphData.links.forEach(function (link) {\n        link.source = link[state.linkSource];\n        link.target = link[state.linkTarget];\n      });\n\n      // Feed data to force-directed layout\n      var isD3Sim = state.forceEngine !== 'ngraph';\n      var layout;\n      if (isD3Sim) {\n        // D3-force\n        (layout = state.d3ForceLayout).stop().alpha(1) // re-heat the simulation\n        .numDimensions(state.numDimensions).nodes(state.graphData.nodes);\n\n        // add links (if link force is still active)\n        var linkForce = state.d3ForceLayout.force('link');\n        if (linkForce) {\n          linkForce.id(function (d) {\n            return d[state.nodeId];\n          }).links(state.graphData.links);\n        }\n\n        // setup dag force constraints\n        var nodeDepths = state.dagMode && getDagDepths(state.graphData, function (node) {\n          return node[state.nodeId];\n        }, {\n          nodeFilter: state.dagNodeFilter,\n          onLoopError: state.onDagError || undefined\n        });\n        var maxDepth = Math.max.apply(Math, _toConsumableArray(Object.values(nodeDepths || [])));\n        var dagLevelDistance = state.dagLevelDistance || state.graphData.nodes.length / (maxDepth || 1) * DAG_LEVEL_NODE_RATIO * (['radialin', 'radialout'].indexOf(state.dagMode) !== -1 ? 0.7 : 1);\n\n        // Reset relevant f* when swapping dag modes\n        if (['lr', 'rl', 'td', 'bu', 'zin', 'zout'].includes(changedProps.dagMode)) {\n          var resetProp = ['lr', 'rl'].includes(changedProps.dagMode) ? 'fx' : ['td', 'bu'].includes(changedProps.dagMode) ? 'fy' : 'fz';\n          state.graphData.nodes.filter(state.dagNodeFilter).forEach(function (node) {\n            return delete node[resetProp];\n          });\n        }\n\n        // Fix nodes to x,y,z for dag mode\n        if (['lr', 'rl', 'td', 'bu', 'zin', 'zout'].includes(state.dagMode)) {\n          var invert = ['rl', 'td', 'zout'].includes(state.dagMode);\n          var fixFn = function fixFn(node) {\n            return (nodeDepths[node[state.nodeId]] - maxDepth / 2) * dagLevelDistance * (invert ? -1 : 1);\n          };\n          var _resetProp = ['lr', 'rl'].includes(state.dagMode) ? 'fx' : ['td', 'bu'].includes(state.dagMode) ? 'fy' : 'fz';\n          state.graphData.nodes.filter(state.dagNodeFilter).forEach(function (node) {\n            return node[_resetProp] = fixFn(node);\n          });\n        }\n\n        // Use radial force for radial dags\n        state.d3ForceLayout.force('dagRadial', ['radialin', 'radialout'].indexOf(state.dagMode) !== -1 ? forceRadial(function (node) {\n          var nodeDepth = nodeDepths[node[state.nodeId]] || -1;\n          return (state.dagMode === 'radialin' ? maxDepth - nodeDepth : nodeDepth) * dagLevelDistance;\n        }).strength(function (node) {\n          return state.dagNodeFilter(node) ? 1 : 0;\n        }) : null);\n      } else {\n        // ngraph\n        var _graph = ngraph.graph();\n        state.graphData.nodes.forEach(function (node) {\n          _graph.addNode(node[state.nodeId]);\n        });\n        state.graphData.links.forEach(function (link) {\n          _graph.addLink(link.source, link.target);\n        });\n        layout = ngraph.forcelayout(_graph, _objectSpread2({\n          dimensions: state.numDimensions\n        }, state.ngraphPhysics));\n        layout.graph = _graph; // Attach graph reference to layout\n      }\n      for (var i = 0; i < state.warmupTicks && !(isD3Sim && state.d3AlphaMin > 0 && state.d3ForceLayout.alpha() < state.d3AlphaMin); i++) {\n        layout[isD3Sim ? \"tick\" : \"step\"]();\n      } // Initial ticks before starting to render\n\n      state.layout = layout;\n      this.resetCountdown();\n    }\n    state.engineRunning = true; // resume simulation\n\n    state.onFinishUpdate();\n  }\n});\n\nfunction fromKapsule (kapsule) {\n  var baseClass = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : Object;\n  var initKapsuleWithSelf = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : false;\n  var ForceGraph = /*#__PURE__*/function (_baseClass) {\n    function ForceGraph() {\n      var _this;\n      _classCallCheck(this, ForceGraph);\n      for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n        args[_key] = arguments[_key];\n      }\n      _this = _callSuper(this, ForceGraph, [].concat(args));\n      _this.__kapsuleInstance = _construct(kapsule, [].concat(_toConsumableArray(initKapsuleWithSelf ? [_this] : []), args));\n      return _this;\n    }\n    _inherits(ForceGraph, _baseClass);\n    return _createClass(ForceGraph);\n  }(baseClass); // attach kapsule props/methods to class prototype\n  Object.keys(kapsule()).forEach(function (m) {\n    return ForceGraph.prototype[m] = function () {\n      var _this$__kapsuleInstan;\n      var returnVal = (_this$__kapsuleInstan = this.__kapsuleInstance)[m].apply(_this$__kapsuleInstan, arguments);\n      return returnVal === this.__kapsuleInstance ? this // chain based on this class, not the kapsule obj\n      : returnVal;\n    };\n  });\n  return ForceGraph;\n}\n\nvar three = window.THREE ? window.THREE : {\n  Group: Group\n}; // Prefer consumption from global THREE, if exists\nvar threeForcegraph = fromKapsule(ForceGraph, three.Group, true);\n\nexport { threeForcegraph as default };\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}